---
title: "Measurement and Dimensionality"
editor_options: 
  chunk_output_type: console
editor: 
  markdown: 
    wrap: 72
---

```{r}
#| label: setup
#| include: false
library(tidyverse)
library(patchwork)
source('_theme/theme_quarto.R')
```

# Course Overview

```{r}
#| echo: false
#| results: "asis"
block1_name = "multilevel modelling<br>working with group structured data"
block1_lecs = c("regression refresher",
                "the multilevel model",
                "more complex groupings",
                "centering, assumptions, and diagnostics",
                "recap")
block2_name = "factor analysis<br>working with multi-item measures"
block2_lecs = c(
  "measurement and dimensionality",
  "exploring underlying constructs (EFA)",
  "testing theoretical models (CFA)",
  "reliability and validity",
  "recap & exam prep"
  )

source("https://raw.githubusercontent.com/uoepsy/junk/main/R/course_table.R")
course_table(block1_name,block2_name,block1_lecs,block2_lecs,week=6)
```

:::{.center-x}
![](img_sandbox/halfway.gif){width=300}
:::

# A confession

![](img_sandbox/comfort.jpg)

# This week {transition="slide"}

- Measurement!
- Multi-item measures
- Scoring (Scale scores and "PCA")

# Measurement

## Thorndike's Credo


> "Whatever exists at all exists in some amount. To know it thoroughly involves knowing its quantity as well as its quality."  
(Edward L. Thorndike. 1918)



## What is measurement?

:::woo
https://app.wooclap.com/events/ECPZGP/votes?view=desktop&mobile=false
:::

<br>

::::{.columns .fragment}
:::{.column width="50%"}
> "The process of assigning numbers to represent properties"  
(Campbell, 1920)

:::
:::{.column width="50%"}
> "The assignment of numbers to objects or events according to rules"   
(Stevens, 1947)

:::
::::

:::{.fragment}

- At the foundations of all scientific inquiry

- Too often taken for granted

- Key question: **What do our numbers represent?**

:::
    

## Quantifying the unquantifiable?


::::{.columns}
:::{.column width="50%"}
<iframe width="560" height="315" src="https://www.youtube.com/embed/8x0COtH4Vrw?si=qgwvKTqC30O553u5" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
:::
:::{.column width="50%"}

```{r}
#| echo: false
magick::image_read("img_sandbox/si_units2.jpeg")
```


- Many things are experienced qualitatively, as matters of degree, and are not easily amenable to direct quantification

- We should always question whether our numbers truly represent a continuous quantity with homogeneous units

:::
::::

## Measurement in Psychology


- Many psychological phenomena cannot be **observed** directly:
    - thoughts, feelings, behaviours etc.

- Grounded in natural language that we discuss every day
    - "aggression", "intelligence", "anxiety"

- Definitions are often **fuzzy** and **lack consensus**

- **Result:** Confusion and complexity in measurement, with scientific definitions often diverging from non-scientific definitions

:::woo
https://app.wooclap.com/events/ECPZGP/votes?view=desktop&mobile=false
:::

## What is a "construct"?

::::{.columns}
:::{.column width="50%"}
### What

- The thing we are intending to quantify

- In psychology, education etc:  
    - a (hopefully useful) abstraction about the world, derived from natural observations
    - often termed a "latent trait" or "ability" (typically denoted $\theta$). 
    
:::
:::{.column width="50%" .fragment}
### Why

- Simplifies the world and provide a shared language for scientific study

- Study the same phenomena across diverse contexts.  
    - e.g., what does **"leadership"** look like in hunter-gatherer societies, in the military and in the music industry?

:::
::::


## Constructs, measures and data

```{r}
#| echo: false
magick::image_read("img_sandbox/measurement.png")
```



## Example

> Are older people more satisfied with life? 112 people from 12 different dwellings (cities/towns) in Scotland. Information on their ages and some measure of life satisfaction.

```{r}
#| echo: true
d3 <- read_csv("https://uoepsy.github.io/data/lmm_lifesatscot.csv")
head(d3)
```

<br>

-   Did anyone stop to think - What is `lifesat` (i.e., life satisfaction)?

- is someone scoring 69 more than twice as "satisfied with life" as someone scoring 31?  


## Impact of differences in perspectives

::::{.columns}
:::{.column width="50%"}

-   Different operationalisations make it difficult to consolidate findings:

    -   **Jingle fallacy** - Using same name to denote different things
    -   **Jangle fallacy** - Using different names to denote same thing

> "Nobody wants to use somebody else's toothbrush"  
(Elson et al., 2023)

:::

:::{.column width="50%"}

```{r}
#| echo: false

magick::image_read("img_sandbox/standards.png")
```

:::
::::




## Impact of differences in perspectives

::::{.columns}
:::{.column width="50%"}

-   Different operationalisations make it difficult to consolidate findings:

    -   **Jingle fallacy** - Using same name to denote different things
    -   **Jangle fallacy** - Using different names to denote same thing

> "Nobody wants to use somebody else's toothbrush"  
(Elson et al., 2023)

![](img_sandbox/dingledangle.jpg)
:::

:::{.column width="50%"}

```{r}
#| echo: false

magick::image_read("img_sandbox/measure_proliferation.PNG")
```

:::
::::


## Psychometrics

::::{.columns}
:::{.column width="40%"}

- Scientific discipline concerned with the construction of psychological measurements

- Connects theoretical constructs to their domains of observable behaviours


:::
:::{.column width="60%"}

```{r}
#| echo: false
magick::image_read("img_sandbox/measurement - Copy.png")
```
:::
::::

## Applications of psychometrics

-   **Education**

    -   Aptitude / ability tests (i.e., standard school tests)
    -   Vocational tests

-   **Business**

    -   Selection (e.g., personality, skills)
    -   Development (e.g., interests, leadership)
    -   Performance (e.g., well-being, engagement)

-   **Health**

    -   Mental health symptoms e.g., anxiety
    -   Clinical diagnoses e.g., personality disorders

-   **Key takeaway:** People make life-changing decisions using
    psychometric evidence every day

## Representational not actual measurement

- We cannot take our ruler and measure "life satisfaction"

- We create tests and hope responses tell us something about the construct we are interested in

- **Important:** Data is only ever item responses, not the construct itself

- Psychometrics is **pseudo-representational**: useful (hopefully) representation of target construct rather than 'ground truth' of universe



## Testing and measurement are two distinct activities

> "When tests are automatically granted the status of measurement, they are that much more easily appropriated as vehicles for social injustice, even when this may well have been the opposite of the intent of the test designer."  
(Derek Briggs 2021)

::::{.columns}
:::{.column width="50%"}

![Alfred Binet (1857-1911) - 'the father of the intelligence test'](img_sandbox/binet.png){width=300}

:::
:::{.column width="50%"}

:::{.incremental}

- Binet's purpose: diagnostic classification to be able to target educational interventions

- adopted and implicitly taken as 'measurement' and used for group comparisons by advocates of eugenics in 20th century USA.

:::

:::
::::


<!-- ## Types of psychometric tests -->

<!-- -   Tests of **typical performance** -->

<!--     -   What participants do on a regular basis -->
<!--     -   Examples: Interests, values, personality traits, political -->
<!--         beliefs -->
<!--     -   Real-world example: "What's your favourite type of cake?" -->


<!-- -   Tests of **maximal performance** -->

<!--     -   What can participants do when exerting maximum effort -->
<!--     -   Examples: Aptitude tests, exams, IQ tests -->
<!--     -   Real-world example: Duolingo, Wordle, revision apps -->

<!-- <br> -->

<!-- -   For the most part, the same statistical models are used to evaluate both -->

## Testing and measurement are two distinct activities

| Concept | Definition | Scope | example |
|-|-|-|-|
|Measurement | Assigning numbers to numbers or events according to rules|Broad (theoretical/methodological) | Quantifying intelligence |
|Testing | Using a specific instrument/procedure to collect numbers | Narrow (practical/applied) | Administering WAIS to assess "IQ" |

<br>

:::{.fragment}

When we confuse testing with measurement: 

- Risks reifying constructs that are partly socially defined (e.g., "intelligence").  

- Enables justifying inequalities ("low scores mean low ability") without examining bias, cultural context, or systemic barriers.

:::

## Thorndike in the 21st Century... 

> Whatever exists at all exists in some amount. To know it thoroughly involves knowing the quality of how it has been quantified.  


## Criteria for good measurement

- To let us consider testing as getting close to measurement, a test must:

    -   **Assess what it is supposed to assess**
    -   **Be consistent and reliable**
    -   **Produce interpretable scores**
    -   Be relevant for specific populations
    -   Differentiate between people in a fair way
    
<br>

-   In this course we will cover first three and how psychologists evaluate them, last two are context-dependent

- We'll talk about this more in later weeks, can you think of any examples of bad measurement?


## So what... 

- psychological constructs are complex, multifaceted, and abstract

- a single question (or "item") will struggle to capture that complexity with any accuracy

- hence: multi-item measures  


## as always, more terminlogy  

![](img_sandbox/terminology/Slide1.PNG)

## as always, more terminlogy  

![](img_sandbox/terminology/Slide2.PNG)


# Some questions

:::woo
https://app.wooclap.com/events/ECPZGP/votes?view=desktop&mobile=false
:::


## Don't do this at home!  

"Dear [Insert LLM name here],   

here is what we think 'creativity' is.  

...  
...  
  
Can you give me 10 items for a questionnaire that capture the different aspects of creativity.   

Give me statements that people can rate their agreement with.  

Please and thank you!

Yours sincerely,  
Josiah King"

:::{.notes}

- get responses from wooclap
- quick create items (via ELM)
  - BE CAREFUL. not ideal. 
- we'll come back to this this afternoon. 
- by this afternoon - get them to fill in items and record L v R handed? 

:::

# BREAK

# Dimension Reduction  

https://edin.ac/3WjlBWW

![](img_sandbox/creativityq.png){width=200px}  



## groups! dependencies! but not as we know it

![](img_sandbox/structure_crossed_qitems.png)

```{r}
set.seed(475)
qd <- 
  lavaan::simulateData(
  "f1 =~ .9*y1 + .9*y2 + .9*y3 + .9*y4 + .9*y5 + .5*y6
   f2 =~ .8*y7 + .8*y8 + .8*y9 + .9*y10
   f1 ~~ .2*f2"
) |> mutate(across(everything(),
                   ~as.numeric(cut(.,7))))
names(qd) <- paste0("Q",1:10)

lifesat_data = qd
names(lifesat_data) = paste0("Q",1:10)
lifesat_data <- lifesat_data |> mutate(
  ppt = paste0("P",formatC(1:nrow(qd),digits=2,flag="0")),
  .before = Q1
)

lifesat_data10 <- lifesat_data
lifesat_data6 <- lifesat_data |> select(ppt:Q6)

lsat_word = 
  tibble(
    Q=paste0("Q",1:10),
    wording=c("Overall, I am satisfied with my life.","In most ways my life is close to my ideal.","The conditions of my life are excellent.","I have gotten the important things I want in life.","If I could live my life over, I would change almost nothing.","My life has turned out better than I expected it would.","I feel happy and content most days.","I experience joy and pleasure regularly in my daily life.","I feel a sense of inner peace and satisfaction.","I wake up most mornings feeling positive about the day ahead.")
  )

```


## longer, wider (faster, stronger?)

::::{.columns}
:::{.column width="50%"}

```{r}
#| echo: false
lifesat_data6 |> 
  pivot_longer(Q1:Q6,names_to="question",values_to="response") |> gt::gt()

```

:::
:::{.column width="50%"}

```{r}
#| echo: false
lifesat_data6 |>
  head() |> gt::gt() |>
  gt::tab_spanner(columns = paste0("Q",1:6), label="life satisfaction")
```

:::
::::

## Scale Scores?  

::::{.columns}
:::{.column width="50%"}

```{r}
gt::gt(lsat_word[1:6,])
```

:::
:::{.column width="50%"}

```{r}
lifesat_data6 |>
  mutate(LFSAT = Q1+Q2+Q3+Q4+Q5+Q6) |> head() |> gt::gt()
```

- each question contains error (because of wording, respondents mood, the context, misunderstanding etc).  

- combine multiple items (e.g., by averaging or summing them) and we hope that the random errors cancel out, and the signal of the true construct becomes clearer    

:::
::::

## Scale Scores?  

Pros: 

- a useful tool in applied settings - the number is always calculated the same way  

Cons: 

- ignores differences in item quality
    - all questions are equally representative of "life satisfaction"

- assumes 'unidimensionality'
    - all questions capture 1 thing, and that 1 thing is "life satisfaction"


## quick refresher

-   **Variance** = Deviance around the mean of a single variable

-   **Covariance** = Representation of how two variables change together

-   **Correlation** = Standardised version of covariance

```{r}
#| echo: false
#| layout: [[33],[33],[33]]

set.seed(986543)
vv = tibble(x = rnorm(10,100,34))
set.seed(5)
cc = tibble(x=vv$x,
            y=rnorm(10,.4*vv$x,5))
cc2 = tibble(x=vv$x,
             y=mean(cc$y) - (cc$y - mean(cc$y))
            )

p1 <- ggplot(vv, aes(x=x,y=0))+geom_point(size=3,alpha=.6)+
  scale_y_continuous(NULL,breaks=NULL)+
  geom_point(x=mean(vv$x),y=0,col="red",shape=4,size=3)

p2 <- ggplot(cc, aes(x=x,y=y))+
  geom_point(size=3,alpha=.6)+
  geom_vline(xintercept=mean(cc$x),col="red",lty="dotted",
             lwd=1)+
  geom_hline(yintercept=mean(cc$y),col="red",lty="dotted",
             lwd=1)+
  ylim(14,64)

p3 <- ggplot(cc2, aes(x=x,y=y))+
  geom_point(size=3,alpha=.6)+
  geom_vline(xintercept=mean(cc2$x),col="red",lty="dotted",
             lwd=1)+
  geom_hline(yintercept=mean(cc2$y),col="red",lty="dotted",
             lwd=1)+
  ylim(14,64)

p1
p2
p3

```

## Covariance/Correlation Matrices

**Assumption throughout this block:** covariance between two items is because they measure the same thing(s) (in theory!)  

::::{.columns}
:::{.column width="50%"}

```{r}
gt::gt(lsat_word[1:6,])
```

:::
:::{.column width="50%"}


```{r}
#| echo: true
#| eval: false
lifesat_data6 |> 
  select(-ppt) |>
  cor()
```

```{r}
lifesat_data6 |> 
  select(-ppt) |>
  cor() |> round(2)
```

:::
::::



## "variables" and "dimensions"


::::{.columns}
:::{.column width="50%"}

```{r}
gt::gt(lsat_word[1:2,])
```

:::
:::{.column width="50%"}
```{r}
#| echo: true
library(psych)
lifesat_data6 |>
  select(Q1:Q2) |>
  pairs.panels()
```

:::
::::



## more variables and dimensions

::::{.columns}
:::{.column width="50%"}
```{r}
gt::gt(lsat_word[1:6,])
```

:::
:::{.column width="50%"}

```{r}
#| echo: true
lifesat_data6 |>
  select(-ppt) |>
  pairs.panels()
```

:::
::::



## more variables and more dimensions

::::{.columns}
:::{.column width="50%"}
```{r}
gt::gt(lsat_word[1:10,])
```

:::
:::{.column width="50%"}

```{r}
#| echo: true
lifesat_data10 |>
  select(-ppt) |>
  pairs.panels()
```

Eurgh... hard to see!  
:::
::::


## more variables and more dimensions (2)

::::{.columns}
:::{.column width="50%"}
```{r}
gt::gt(lsat_word[1:10,])
```
:::
:::{.column width="50%"}

```{r}
#| echo: true
lifesat_data10 |>
  select(-ppt) |>
  cor() |> 
  heatmap()
```

Think: "buckets" of co-variation!  
:::
::::



## more variables and more dimensions (2)

::::{.columns}
:::{.column width="50%"}
```{r}
tibble(
  Q = lsat_word$Q,
  wording = lsat_word$wording[c(1,2,7,3,8,4,9,5,10,6)]
) |> gt::gt()
```

:::
:::{.column width="50%"}

```{r}
#| echo: true
#| eval: false
lifesat_data10 |>
  select(-ppt) |>
  cor() |> 
  heatmap()
```
```{r}
qd3 = lifesat_data10[,c(1,2,7,3,8,4,9,5,10,6)+1]
names(qd3) = paste0("Q",1:10)
heatmap(cor(qd3), Colv=NA,Rowv=NA)
```
Visibility of the "buckets" depends on ordering of the items!  
:::
::::


## how many dimensions can you think in? 

::::{.columns}
:::{.column width="33%"}
Three variables measuring unrelated things: 

Rate agreement on:  

- Q1: I am the life and soul of the party
- Q2: I like penguins
- Q3: I enjoy studying statistics

:::
:::{.column width="33%"}
Three variables perfectly measuring the exact same thing

Time spent looking at phone last week:

- In hours
- In days
- In weeks

:::
:::{.column width="33%"}
Three variables measuring the same thing but differently

Rate agreement on:  

- Q1: I think cake is the best food
- Q2: I feel great when I eat cake
- Q3: I often eat cake

:::
::::

```{r}
#| layout: [[33],[33],[33]]
library(rgl)
library(psych)
set.seed(4)
R = matrix(c(1,.0,0,
             0,1,0,
             0,0,1),nrow=3)
Sigma = diag(3)%*%R%*%diag(3)
Mean <- rep(0,3)
x <- MASS::mvrnorm(500, Mean, Sigma)
x <- apply(x,2,\(x) as.numeric(cut(x,9)))
mydata <- as.data.frame(x)
names(mydata) <- c("M","P","S")
plot3d(x, box = FALSE, 
       xlab="Q1",ylab="Q2",zlab="Q3")
# plot3d(ellipse3d(cov(mydata), centre = colMeans(mydata)), col = "#A41AE4", alpha = 0.4, add = TRUE)
rglwidget()


set.seed(4)
xx <- runif(100,0,7*24)
x <- cbind(xx, xx/24, xx/24/7)
mydata <- as.data.frame(x)
names(mydata) <- c("M","P","S")
plot3d(x, box = FALSE, 
       xlab="hours",ylab="days",zlab="weeks")
rglwidget()

set.seed(4)
R = matrix(c(1,.7,.7,
             .7,1,.7,
             .7,.7,1),nrow=3)
Sigma = diag(3)%*%R%*%diag(3)
Mean <- rep(0,3)
x <- MASS::mvrnorm(500, Mean, Sigma)
x <- apply(x,2,\(x) as.numeric(cut(x,9)))
mydata <- as.data.frame(x)
names(mydata) <- c("M","P","S")
plot3d(x, box = FALSE, 
       xlab="Q1",ylab="Q2",zlab="Q3")
# plot3d(ellipse3d(cov(mydata), centre = colMeans(mydata)), col = "#A41AE4", alpha = 0.4, add = TRUE)
rglwidget()
```



## how many dimensions can you think in? 

::::{.columns}
:::{.column width="33%"}
Three variables measuring unrelated things: 

Rate agreement on:  

- Q1: I am the life and soul of the party
- Q2: I like penguins
- Q3: I enjoy studying statistics

:::
:::{.column width="33%"}
Three variables perfectly measuring the exact same thing

Time spent looking at phone last week:

- In hours
- In days
- In weeks

:::
:::{.column width="33%"}
Three variables measuring the same thing but differently

Rate agreement on:  

- Q1: I think cake is the best food
- Q2: I feel great when I eat cake
- Q3: I often eat cake

:::
::::

```{r}
#| layout: [[33],[33],[33]]
set.seed(4)
R = matrix(c(1,.0,0,
             0,1,0,
             0,0,1),nrow=3)
Sigma = diag(3)%*%R%*%diag(3)
Mean <- rep(0,3)
x <- MASS::mvrnorm(500, Mean, Sigma)
x <- apply(x,2,\(x) as.numeric(cut(x,9)))
mydata <- as.data.frame(x)
names(mydata) <- c("M","P","S")
plot3d(x, box = FALSE, 
       xlab="Q1",ylab="Q2",zlab="Q3")
plot3d(ellipse3d(cov(mydata), centre = colMeans(mydata)), col = "#A41AE4", alpha = 0.4, add = TRUE)
plot3d(
  abclines3d(mean(mydata$M),mean(mydata$P),mean(mydata$S),
             a=principal(x,nfactors=3,cov=TRUE,rotate="none")$loadings[,1],
             col="green"),lwd=2, add=TRUE)
plot3d(
  abclines3d(mean(mydata$M),mean(mydata$P),mean(mydata$S),
             a=principal(x,nfactors=3,cov=TRUE,rotate="none")$loadings[,2],
             col="red"), lwd=2, add=TRUE)
plot3d(
  abclines3d(mean(mydata$M),mean(mydata$P),mean(mydata$S),
    a=principal(x,nfactors=3,cov=TRUE,rotate="none")$loadings[,3],
           col="blue"), lwd=2, add=TRUE)
rglwidget()


set.seed(4)
xx <- runif(100,0,7*24)
x <- cbind(xx, xx/24, xx/24/7)
mydata <- as.data.frame(x)
names(mydata) <- c("M","P","S")
plot3d(x, box = FALSE, 
       xlab="hours",ylab="days",zlab="weeks")
plot3d(
  abclines3d(0,0,0,
             a=c(1,1/24,1/24/7),
             col="green"),lwd=2, add=TRUE)
rglwidget()

set.seed(4)
R = matrix(c(1,.7,.7,
             .7,1,.7,
             .7,.7,1),nrow=3)
Sigma = diag(3)%*%R%*%diag(3)
Mean <- rep(0,3)
x <- MASS::mvrnorm(500, Mean, Sigma)
x <- apply(x,2,\(x) as.numeric(cut(x,9)))
mydata <- as.data.frame(x)
names(mydata) <- c("M","P","S")
plot3d(x, box = FALSE, 
       xlab="Q1",ylab="Q2",zlab="Q3")
plot3d(ellipse3d(cov(mydata), centre = colMeans(mydata)), col = "#A41AE4", alpha = 0.4, add = TRUE)
plot3d(
  abclines3d(mean(mydata$M),mean(mydata$P),mean(mydata$S),
             a=principal(x,nfactors=3,cov=TRUE,rotate="none")$loadings[,1],
             col="green"),lwd=2, add=TRUE)
plot3d(
  abclines3d(mean(mydata$M),mean(mydata$P),mean(mydata$S),
             a=principal(x,nfactors=3,cov=TRUE,rotate="none")$loadings[,2],
             col="red"), lwd=2, add=TRUE)
plot3d(
  abclines3d(mean(mydata$M),mean(mydata$P),mean(mydata$S),
    a=principal(x,nfactors=3,cov=TRUE,rotate="none")$loadings[,3],
           col="blue"), lwd=2, add=TRUE)
rglwidget()
```


## Principal Component Analysis (PCA)


In short:  

- re-express covariances between $k$ items as $k$ dimensions  

- dimensions are termed "components" and are _orthogonal_ (perpendicular/uncorrelated)

- dimensions sequentially capture most variance  


## eigendecomposition

::::{.columns}
:::{.column width="50%"}

In short:  

- The math behind PCA

It's a lot  
We don't need to understand it.  

![source: https://it.memedroid.com/memes/detail/3218300/And-thats-why-my-life-is-so-hard](https://images3.memedroid.com/images/UPLOADED294/6011791943290.jpeg){width=500}

:::
:::{.column width="50%" .fragment}
Some terms will come up...  


- "eigenvector" 
    - **direction** of each dimension (relative to our original variables)
    - which variables is the dimension related to?   

- "eigenvalue"
    - **magnitude** of each dimension
    - how much variance is captured by the dimension?  




:::

::::

<!-- ## v simplified case -->

<!-- ```{r} -->
<!-- library(plotly) -->
<!-- y1 <- c(3,3,2) -->
<!-- y2 <- c(-3,-3,-1) -->
<!-- y3 <- c(5,4,3) -->

<!-- # y2 <- y1*1.1 -->
<!-- # y3 <- y1*0.7 -->


<!-- df = data.frame(y1,y2,y3) -->
<!-- rownames(df) = c("Person A","Person B","Person C") -->
<!-- df -->
<!-- cor(df) -->
<!-- dft = data.frame(t(df)) -->
<!-- dft -->


<!-- arrow_data <- data.frame( -->
<!--   Person.A = c(rbind(0, dft$Person.A)), -->
<!--   Person.B = c(rbind(0, dft$Person.B)), -->
<!--   Person.C = c(rbind(0, dft$Person.C)), -->
<!--   group = rep(1:nrow(dft), each = 2) -->
<!-- ) -->
<!-- plot_ly(arrow_data, x = ~Person.A, y = ~Person.B,  -->
<!--         z = ~Person.C) |> -->
<!--   add_trace(type = "scatter3d", mode = "lines",  -->
<!--             line = list(color = "blue", width = 4), -->
<!--             split = ~group, showlegend = FALSE) |> -->
<!--   add_markers(data = dft, x = ~Person.A, y = ~Person.B, -->
<!--               z = ~Person.C, -->
<!--               marker = list(size = 5, color = "red")) |> -->
<!--   layout(scene = list( -->
<!--     xaxis = list(range = c(-5, 5)), -->
<!--     yaxis = list(range = c(-5, 5)), -->
<!--     zaxis = list(range = c(-5, 5)) -->
<!--   )) -->
<!-- ``` -->



<!-- ```{r} -->
<!-- y1 <- c(1,1,5) -->
<!-- y2 <- c(1,2,4) -->
<!-- y3 <- c(1,3,5) -->
<!-- df = data.frame(y1,y2,y3) -->
<!-- rownames(df) = c("Person A","Person B","Person C") -->
<!-- df -->
<!-- cor(df) -->

<!-- dft = data.frame(t(df)) -->
<!-- dft -->


<!-- arrow_data <- data.frame( -->
<!--   Person.A = c(rbind(0, dft$Person.A)), -->
<!--   Person.B = c(rbind(0, dft$Person.B)), -->
<!--   Person.C = c(rbind(0, dft$Person.C)), -->
<!--   group = rep(1:nrow(dft), each = 2) -->
<!-- ) -->
<!-- plot_ly(arrow_data, x = ~Person.A, y = ~Person.B,  -->
<!--         z = ~Person.C) |> -->
<!--   add_trace(type = "scatter3d", mode = "lines", -->
<!--             line = list(color = "blue", width = 4), -->
<!--             split = ~group, showlegend = FALSE) |> -->
<!--   add_markers(data = dft, x = ~Person.A, y = ~Person.B, -->
<!--               z = ~Person.C, -->
<!--               marker = list(size = 5, color = "red")) |> -->
<!--   layout(scene = list( -->
<!--     xaxis = list(range = c(0, 5)), -->
<!--     yaxis = list(range = c(0, 5)), -->
<!--     zaxis = list(range = c(0, 5)) -->
<!--   )) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- cor(df) |> round(2) -->
<!-- plot(df) -->

<!-- eigen(cor(df)) -->

<!-- ``` -->



## PCA in R

::::{.columns}
:::{.column width="30%"}
```{r}
#| echo: true
#| eval: false
lifesat_data6 |>
  select(-ppt) |>
  cor()
```
```{r}
lifesat_data6 |>
  select(-ppt) |>
  cor() |> round(2)
```
:::
:::{.column width="70%"}

```{r}
#| echo: true
#| eval: false
library(psych)
principal(lifesat_data6[,-1], nfactors = 6, rotate = "none")  
```

- `principal()` can take a covariance matrix, a correlation matrix, or the raw data.  
- `rotate = "none"` is saying that we want these dimensions to be orthogonal (in future weeks we'll mix things up)

:::
::::

## PCA in R (2)

::::{.columns}
:::{.column width="30%"}
```{r}
#| echo: true
#| eval: false
lifesat_data6 |>
  select(-ppt) |>
  cor()
```
```{r}
lifesat_data6 |>
  select(-ppt) |>
  cor() |> round(2)
```
:::
:::{.column width="70%"}

```{r}
#| echo: true
#| eval: false
library(psych)
principal(lifesat_data6[,-1], nfactors = 6, rotate = "none")  
```
```{r}
#| include: false
library(psych)
principal(lifesat_data6[,-1], nfactors = 6, rotate = "none")  
```

![](img_sandbox/pca_first_look.png)

:::
::::



## the reduction: how many components do we keep?

how many/how much variation do you want to keep?

![](img_sandbox/pca_first_look2.png)

## the reduction: how many components do we keep? 

scree plots (these are the eigenvalues - the magnitudes)

```{r}
scree(lifesat_data6[,-1])
```

## the reduction: how many components do we keep? 


::::{.columns}
:::{.column width="50%"}
parallel analysis  

```{r}
fa.parallel(lifesat_data6[,-1], fa = "pc", n.iter = 500)
```
:::
:::{.column width="50%"}

minimum average partial  

```{r}
VSS(lifesat_data6[,-1], plot = FALSE)
```
:::
::::

## Scoring

Where each observation stands on each dimension.  

```{r}
#| echo: true
#| eval: false
# We're keeping only 1 component now:
mypca <- principal(lifesat_data6[,-1], nfactors = 1, rotate = "none")  

mypca$scores
```
```
         PC1
[1,]  1.0525
[2,] -0.2234
[3,]  1.0369
[4,] -0.8464
[5,] -0.2131
[6,] -0.0231
...   ...
...   ...
```

- so if the dimension is highly related to items 1, 2, and 3, and person $i$ scores high on those items, then they will score high on the dimension.  

## Using Scores (1)

```{r}
#| include: false
set.seed(7945)
  
  SS = matrix(runif(36,0.5,1), ncol = 6)
  SS[1:5,6] <- SS[6,1:5] <- runif(5,.1,.3)
  SS[sample(1:6,1),sample(1:6,1)] <- runif(1,.1,.5)
  SS[sample(1:6,1),sample(1:6,1)] <- runif(1,.1,.5)
  SS[sample(1:6,1),sample(1:6,1)] <- runif(1,.1,.5)
  SS[sample(1:6,1),sample(1:6,1)] <- runif(1,.1,.5)
  SS[sample(1:6,1),sample(1:6,1)] <- runif(1,.1,.5)
  SS[sample(1:6,1),sample(1:6,1)] <- runif(1,.1,.5)
  SS = crossprod(SS)
  
  diag(SS) <- diag(SS)*2
  
  mystudy <- MASS::mvrnorm(n=75, mu=rep(0,6),Sigma = SS) |> as_tibble() |>
    mutate(across(everything(), ~as.numeric(cut(.,7))))
  names(mystudy) <- paste0("Q",1:6)
  mypca <- principal(mystudy, nfactors = 1, rotate = "none")  
  
  effsize <- rnorm(1,-.61,.5)
  
  mystudy <- mystudy |>
    mutate(
      BART = round(rnorm(n(),10+effsize*mypca$scores+.3*Q6,2.9))
    )

  # mod0<- lm(BART ~ Q1 + Q2 + Q3 + Q4 + Q5 + Q6, data = mystudy)
  # mod1<- lm(mystudy$BART~mypca$scores[,1])
  # mod2<- lm(mystudy$BART~rowSums(mystudy[,1:6]))

```

::::{.columns}
:::{.column width="50%"}
Let's imagine we did a study where participants:  

1. completed our life satisfaction questionnaire
2. completed the "balloon analogue risk task"   
    - *(essentially how far do you pump up a balloon - to measure risk taking behaviour)*
    
> RQ: Do people who are more satisfied with life engage with less risk taking?  


Data:  
```{r}
#| echo: true
head(mystudy)
```

:::
:::{.column width="50%" .fragment}
```{r}
#| echo: true
mod <- lm(BART ~ Q1 + Q2 + Q3 + Q4 + Q5 + Q6, data = mystudy)
summary(mod)
```
:::
::::

## Using Scores (2)

::::{.columns}
:::{.column width="50%"}
Let's imagine we did a study where participants:  

1. completed our life satisfaction questionnaire
2. completed the "balloon analogue risk task"   
    - *(essentially how far do you pump up a balloon - to measure risk taking behaviour)*
    
> RQ: Do people who are more satisfied with life engage with less risk taking?  

Data:  
```{r}
#| echo: true
head(mystudy)
```

:::
:::{.column width="50%"}
```{r}
#| echo: true
library(car)
vif(mod)
```
:::
::::


## Using Scores (3)

```{r}
#| echo: false
mypca <- principal(mystudy[,1:6], nfactors = 1, rotate = "none")
mystudy$PC1 = mypca$scores[,1]
```


::::{.columns}
:::{.column width="50%"}
Let's imagine we did a study where participants:  

1. completed our life satisfaction questionnaire
2. completed the "balloon analogue risk task"   
    - *(essentially how far do you pump up a balloon - to measure risk taking behaviour)*
    
> RQ: Do people who are more satisfied with life engage with less risk taking?  

Data:  
```{r}
#| echo: true
head(mystudy)
```

:::
:::{.column width="50%"}
```{r}
#| echo: true
mypca <- principal(mystudy[,1:6], nfactors = 1, rotate = "none")
mystudy$PC1 = mypca$scores[,1]

mod <- lm(BART ~ PC1, data = mystudy)
summary(mod)
```
:::
::::

## Using Scale Scores

```{r}
#| echo: false
mystudy$PC1 <- NULL
mystudy$SScore <- rowSums(mystudy[,1:6])
```

::::{.columns}
:::{.column width="50%"}
Let's imagine we did a study where participants:  

1. completed our life satisfaction questionnaire
2. completed the "balloon analogue risk task"   
    - *(essentially how far do you pump up a balloon - to measure risk taking behaviour)*
    
> RQ: Do people who are more satisfied with life engage with less risk taking?  

Data:  
```{r}
#| echo: true
head(mystudy)
```

:::
:::{.column width="50%"}
```{r}
#| echo: true
mystudy$SScore <- rowSums(mystudy[,1:6])

mod <- lm(BART ~ SScore, data = mystudy)
summary(mod)
```
:::
::::

## This week 


::::{.columns}
:::{.column width="50%"}
### Tasks

![](img_sandbox/readings.png){width=60px style="margin:0;margin-left:-60px"} Complete readings 

<br>

![](img_sandbox/labs.svg){width=60px style="margin:0;margin-left:-60px"} Attend your lab and work together on the exercises 

<br>

![](img_sandbox/exam.svg){width=60px style="margin:0;margin-left:-60px"} Complete the weekly quiz 


:::

:::{.column width="50%"}
### Support

![](img_sandbox/forum.svg){width=60px style="margin:0;margin-left:-60px"} Piazza forum! 

<br>

![](img_sandbox/oh.png){width=60px style="margin:0;margin-left:-60px"} Office hours (see Learn page for details)



:::
::::



