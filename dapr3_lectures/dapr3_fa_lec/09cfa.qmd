---
title: "Confirmatory Factor Analysis (CFA)"
editor_options: 
  chunk_output_type: console
editor: 
  markdown: 
    wrap: 72
---


```{r}
#| label: setup
#| include: false
library(tidyverse)
library(patchwork)
library(psych)
library(lavaan)
source('_theme/theme_quarto.R')
```

# Course Overview

```{r}
#| results: "asis"
block1_name = "multilevel modelling<br>working with group structured data"
block1_lecs = c("regression refresher",
                "the multilevel model",
                "more complex groupings",
                "centering, assumptions, and diagnostics",
                "recap")
block2_name = "factor analysis<br>working with multi-item measures"
block2_lecs = c(
  "measurement and dimensionality",
  "exploring underlying constructs (EFA)",
  "testing theoretical models (CFA)",
  "reliability and validity",
  "recap & exam prep"
  )

source("https://raw.githubusercontent.com/uoepsy/junk/main/R/course_table.R")
course_table(block1_name,block2_name,block1_lecs,block2_lecs,week=8)
```

# This week {transition="slide"}

- CFA vs EFA
- CFA in R (lavaan)
- Model Fit
- Latent Variable Scaling
- the gateway to SEM

# from EFA to CFA

## What is your quest?  

too many correlated variables. need to reduce >> PCA

want to understand underlying structure of a set of correlated variables >> EFA

want to test a theoretical structure underlying a set of variables >> CFA

## EFA in diagrams

non rotated
rotated

## CFA in diagrams

absence of arrows = theoretical constraint

# CFA in R

## lavaan package

"latent variable analysis"

## steps

1. specify
2. estimate

steps of SEM?
- measures, assumptions, data
- specification
- identification
- estimation
- fit
- possible respecification
- interpretation

## example



# evaluating model fit

## it's a model! how well does it fit?  

outcome = model + error
cov matrix = set of parameters in the model + error
cov matrix = model implied cov matrix + error

## diagrams imply things! 


there's a whole logic to these diagrams that we won't go into.  
(see reading examples optional)

## degrees of freedom

## identified over and under


## model fit


## fit indices


## parameter estimates


# latent variable scaling


# the gateway to structural equation modelling

## tracing paths

there's a logic to the diagrams - do-calculus. 
    mainly for back of envelope thinking 
    helps with any part of a study that is observed not manipulated/randomly allocated
    essentially a way of helping to figure out how to get at the unbiased estimate of the thing we are interested in
there's an algebra to the paths
    when paths are linear
    "covariance algebra" and "path tracing" tells us what the model implied covariances are
    kind of wild but we could get regression estimates from just a cov matrix

opens the door to

1) testing theoretical models (draw lines between variables, "how well does this reproduce the cov matrix?"). wild west.
and
2) estimating paths between constructs while explicitly modelling measurement error

## error error everywhere  

all this error, what should we do? model it!  

## structural vs measurement parts


## all measured at once

## example


## 















