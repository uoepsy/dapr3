<!DOCTYPE html>
<html lang="en"><head>
<script src="04assumptions_files/libs/clipboard/clipboard.min.js"></script>
<script src="04assumptions_files/libs/quarto-html/tabby.min.js"></script>
<script src="04assumptions_files/libs/quarto-html/popper.min.js"></script>
<script src="04assumptions_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="04assumptions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="04assumptions_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="04assumptions_files/libs/quarto-html/quarto-syntax-highlighting-ce80fb680f754bdddd2e33f428b7c2fe.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.42">

  <meta name="author" content="Josiah King">
  <title>Assumptions, Diagnostics, and Centering</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="04assumptions_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="04assumptions_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #1f1c1b;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #1f1c1b; } /* Normal */
    code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
    code span.an { color: #ca60ca; } /* Annotation */
    code span.at { color: #0057ae; } /* Attribute */
    code span.bn { color: #b08000; } /* BaseN */
    code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
    code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #924c9d; } /* Char */
    code span.cn { color: #aa5500; } /* Constant */
    code span.co { color: #898887; } /* Comment */
    code span.cv { color: #0095ff; } /* CommentVar */
    code span.do { color: #607880; } /* Documentation */
    code span.dt { color: #0057ae; } /* DataType */
    code span.dv { color: #b08000; } /* DecVal */
    code span.er { color: #bf0303; text-decoration: underline; } /* Error */
    code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
    code span.fl { color: #b08000; } /* Float */
    code span.fu { color: #644a9b; } /* Function */
    code span.im { color: #ff5500; } /* Import */
    code span.in { color: #b08000; } /* Information */
    code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
    code span.op { color: #ca60ca; } /* Operator */
    code span.ot { color: #006e28; } /* Other */
    code span.pp { color: #006e28; } /* Preprocessor */
    code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #ff5500; } /* SpecialString */
    code span.st { color: #bf0303; } /* String */
    code span.va { color: #0057ae; } /* Variable */
    code span.vs { color: #bf0303; } /* VerbatimString */
    code span.wa { color: #bf0303; } /* Warning */
  </style>
  <link rel="stylesheet" href="04assumptions_files/libs/revealjs/dist/theme/quarto-81154e5362a38681c1452ce11bf63386.css">
  <link rel="stylesheet" href="img/css/wizard.css">
  <link href="04assumptions_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="04assumptions_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="04assumptions_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="04assumptions_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="04assumptions_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="04assumptions_files/libs/revealjs/plugin/reveal-attribution/attribution.css" rel="stylesheet">
  <link href="04assumptions_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>

  $(document).ready(function() {

      $('.cell').each(function() {

          let highlightLines = $(this).attr('data-output-line-numbers');

          if (highlightLines) {

              let lines = highlightLines.split(',').map(x => parseInt(x));

              $(this).find('.cell-output-stdout pre code').html(function(_, html) {

                  return html.split('\n').map((line, index) => {

                      if (lines.includes(index + 1)) {

                          return '<span style="background-color: #D0D8FC;">' + line + '</span>';

                      } else {

                          return line;

                      }

                  }).join('\n');

              });

          }

      });

  });

  </script>

</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#88B04B" data-background-image="img/logo.svg" data-background-position="2% 2%" data-background-size="25%" class="quarto-title-block center">
  <h1 class="title">Assumptions, Diagnostics, and Centering</h1>
  <p class="subtitle">Data Analysis for Psychology in R 3</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Josiah King 
</div>
        <p class="quarto-title-affiliation">
            Psychology, PPLS
          </p>
        <p class="quarto-title-affiliation">
            University of Edinburgh
          </p>
    </div>
</div>

</section>
<section id="course-overview" class="title-slide slide level1 center" data-background-color="#88B04B">
<h1>Course Overview</h1>
<table style="border: 1px solid black;>
  <tr style=" padding:="" 0="" 1em="" 1em;"="">
    <tbody><tr><td rowspan="5" style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1;text-align:center;vertical-align: middle">
        <b>multilevel modelling<br>working with group structured data</b></td>
    <td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1">
        regression refresher</td>
  </tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1">
        the multilevel model</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1">
        more complex groupings</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1">
        <b>centering, assumptions, and diagnostics</b></td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        recap</td></tr>

  <tr style="padding: 0 1em 0 1em;">
    <td rowspan="5" style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4;text-align:center;vertical-align: middle">
        <b>factor analysis<br>working with multi-item measures</b></td>
    <td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        measurement and dimensionality</td>
  </tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        exploring underlying constructs (EFA)</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        testing theoretical models (CFA)</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        reliability and validity</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        recap &amp; exam prep</td></tr>
</tbody></table>
</section>

<section id="this-week" class="title-slide slide level1 center" data-transition="slide" data-background-color="#88B04B">
<h1>This week</h1>
<ul>
<li>Assumptions of multilevel models
<ul>
<li>some suggestions when things look awry</li>
</ul></li>
<li>Case Diagnostics
<ul>
<li>what if results are dependent on a small set of influential observations/clusters?</li>
</ul></li>
<li>Centering predictors in multilevel models
<ul>
<li>what does “changing 1 in x” actually mean?</li>
</ul></li>
</ul>
</section>

<section>
<section id="assumptions" class="title-slide slide level1 center" data-background-color="#88B04B">
<h1>Assumptions</h1>

</section>
<section id="assumptions-in-lm" class="slide level2">
<h2>Assumptions in LM</h2>
<div class="columns">
<div class="column" style="width:50%;">
<h4 id="the-general-idea">The general idea</h4>
<ul>
<li><span class="math inline">\(\varepsilon_i \sim N(0,\sigma^2)\)</span> iid</li>
<li>“zero mean and constant variance”</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-2-1.svg"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<h4 id="recipe-book">Recipe book</h4>
<ul>
<li><strong>L</strong>inearity</li>
<li><strong>I</strong>ndependence</li>
<li><strong>N</strong>ormality</li>
<li><strong>E</strong>qual Variances</li>
</ul>
</div></div>
</section>
<section id="whats-different-in-mlm" class="slide level2">
<h2>What’s different in MLM?</h2>
<h3 id="answer-not-much">Answer: Not much!</h3>
<ul>
<li><p>General idea is unchanged: error is random</p></li>
<li><p>But we now have residuals at multiple levels! Random effects can be viewed as residuals at another level.</p></li>
</ul>
</section>
<section id="resids" class="slide level2">
<h2>Resids</h2>

<img data-src="img_sandbox/Slide1.PNG" class="quarto-figure quarto-figure-left r-stretch" width="1280"></section>
<section id="resids-2" class="slide level2">
<h2>Resids (2)</h2>

<img data-src="img_sandbox/Slide2.PNG" class="quarto-figure quarto-figure-left r-stretch" width="1280"></section>
<section id="resids-3" class="slide level2">
<h2>Resids (3)</h2>

<img data-src="img_sandbox/Slide3.PNG" class="quarto-figure quarto-figure-left r-stretch" width="1280"></section>
<section id="random-effects-as-level-2-residuals" class="slide level2">
<h2>Random effects as level 2 residuals</h2>

<img data-src="img_sandbox/lmmwodot.png" class="quarto-figure quarto-figure-left r-stretch" width="1151"></section>
<section id="random-effects-as-level-2-residuals-1" class="slide level2" data-visibility="uncounted">
<h2>Random effects as level 2 residuals</h2>

<img data-src="img_sandbox/lmmwdot.png" class="quarto-figure quarto-figure-left r-stretch" width="1151"></section>
<section id="random-effects-as-level-2-residuals-2" class="slide level2">
<h2>Random effects as level 2 residuals</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div style="width:0; float:left;">
<p><span class="math display">\[
\begin{align}
&amp; \text{for observation }j\text{ in group }i \\
\quad \\
&amp; \text{Level 1:} \\
&amp; \color{red}{y_{ij}} = \color{blue}{b_{0i} \cdot 1 + b_{1i} \cdot x_{ij}} + \varepsilon_{ij} \\
&amp; \quad \\
&amp; \text{Level 2:} \\
&amp; \color{blue}{b_{0i}} = \gamma_{00} + \color{orange}{\zeta_{0i}} \\
&amp; \color{blue}{b_{1i}} = \gamma_{10} + \color{orange}{\zeta_{1i}} \\
&amp; \qquad \\
&amp; \begin{bmatrix} \color{orange}{\zeta_{0i}} \\ \color{orange}{\zeta_{1i}} \end{bmatrix}
\sim N
\left(
    \begin{bmatrix} 0 \\ 0 \end{bmatrix},
    \begin{bmatrix}
        \color{orange}{\sigma_0} &amp; \color{orange}{\rho_{01}} \\
        \color{orange}{\rho_{01}} &amp; \color{orange}{\sigma_1}
    \end{bmatrix}
\right) \\
&amp; \varepsilon_{ij} \sim N(0,\sigma_\varepsilon) \\
\end{align}
\]</span></p>
</div>
</div><div class="column" style="font-size: 70%;color:#999999">

</div></div>
</section>
<section id="random-effects-as-level-2-residuals-3" class="slide level2" data-visibility="uncounted">
<h2>Random effects as level 2 residuals</h2>
<!-- > 200 pupils from 20 schools completed a survey containing the Emotion Dysregulation Scale (EDS) and the Child Routines Questionnaire (CRQ). Eight of the schools were taking part in an initiative to specifically teach emotion regulation as part of the curriculum. Data were also gathered regarding the average hours each child slept per night. -->
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math inline">\(\varepsilon\)</span><br>
<code>resid(model)</code><br>
zero mean, constant variance</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-9-1.svg" width="400"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><span class="math inline">\(\color{orange}{\zeta}\)</span><br>
<code>ranef(model)</code><br>
zero mean, constant variance</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>$cluster</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-10-1.svg" width="400"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="assumption-plots-residuals-vs-fitted" class="slide level2">
<h2>Assumption Plots: Residuals vs Fitted</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model, <span class="at">type=</span><span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"smooth"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-11-1.svg" class="r-stretch"></section>
<section id="assumption-plots-qqplots" class="slide level2">
<h2>Assumption Plots: qqplots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">resid</span>(model))</span>
<span id="cb3-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">resid</span>(model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-12-1.svg" class="r-stretch"></section>
<section id="assumption-plots-scale-location" class="slide level2">
<h2>Assumption Plots: Scale-Location</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model, </span>
<span id="cb4-2"><a href="" aria-hidden="true" tabindex="-1"></a>     <span class="at">form =</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(<span class="fu">resid</span>(.))) <span class="sc">~</span> <span class="fu">fitted</span>(.),</span>
<span id="cb4-3"><a href="" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"smooth"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-13-1.svg" class="r-stretch"></section>
<section id="assumption-plots-scale-location-1" class="slide level2" data-visibility="uncounted">
<h2>Assumption Plots: Scale-Location</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model, </span>
<span id="cb5-2"><a href="" aria-hidden="true" tabindex="-1"></a>     <span class="at">form =</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(<span class="fu">resid</span>(.))) <span class="sc">~</span> <span class="fu">fitted</span>(.) <span class="sc">|</span> cluster,</span>
<span id="cb5-3"><a href="" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"p"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-14-1.svg" class="r-stretch"></section>
<section id="assumption-plots-ranefs" class="slide level2">
<h2>Assumption Plots: Ranefs</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>base</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">ranef</span>(model)<span class="sc">$</span>cluster[,<span class="dv">1</span>])</span>
<span id="cb6-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">ranef</span>(model)<span class="sc">$</span>cluster[,<span class="dv">1</span>])</span>
<span id="cb6-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">ranef</span>(model)<span class="sc">$</span>cluster[,<span class="dv">2</span>])</span>
<span id="cb6-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">ranef</span>(model)<span class="sc">$</span>cluster[,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-15-1.svg"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>ggplot</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="" aria-hidden="true" tabindex="-1"></a>rans <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">ranef</span>(model)<span class="sc">$</span>cluster)</span>
<span id="cb7-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rans, <span class="fu">aes</span>(<span class="at">sample =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb7-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>() <span class="sc">+</span></span>
<span id="cb7-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"random intercept"</span>)</span>
<span id="cb7-6"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rans, <span class="fu">aes</span>(<span class="at">sample =</span> x1)) <span class="sc">+</span> </span>
<span id="cb7-8"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>()</span>
<span id="cb7-9"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"random slope"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-17-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="posterior-predictions" class="slide level2">
<h2>“posterior” predictions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_predictions</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-18-1.svg" class="r-stretch"></section>
<section id="section" class="slide level2">
<h2>!?!?!?!</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="img_sandbox/truth.png"></p>
</div><div class="column" style="width:50%;">
<p><br><br></p>
<p>Assumptions are not <em>either</em> “violated” <em>or</em> “not violated”.</p>
<p><br></p>
<p>Assumptions are the things <em>we</em> assume when ‘using’ a model.</p>
<ul>
<li>the question is whether we (given our plots etc) are happy to assume these things</li>
</ul>
</div></div>
</section></section>
<section>
<section id="troubleshooting" class="title-slide slide level1 center" data-background-color="#88B04B">
<h1>Troubleshooting</h1>

</section>
<section id="same-old-study" class="slide level2">
<h2>Same old study</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><em>In a study examining how cognition changes over time, a sample of 20 participants took the Addenbrooke’s Cognitive Examination (ACE) every 2 years from age 60 to age 78.</em></p>
<p><small>Each participant has 10 datapoints. Participants are clusters.</small></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://uoepsy.github.io/data/lmm_mindfuldecline.csv"</span>)</span>
<span id="cb9-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  sitename ppt   condition visit   age   ACE imp  
  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
1 Sncbk    PPT_1 control       1    60  84.5 unimp
2 Sncbk    PPT_1 control       2    62  85.6 imp  
3 Sncbk    PPT_1 control       3    64  84.5 imp  
4 Sncbk    PPT_1 control       4    66  83.1 imp  
5 Sncbk    PPT_1 control       5    68  82.3 imp  
6 Sncbk    PPT_1 control       6    70  83.3 imp  </code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-21-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="model-mis-specification" class="slide level2">
<h2>Model mis-specification</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="" aria-hidden="true" tabindex="-1"></a>mymodel <span class="ot">&lt;-</span> <span class="fu">lmer</span>(ACE <span class="sc">~</span> visit <span class="sc">*</span> condition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ppt), <span class="at">data =</span> d3)</span>
<span id="cb11-2"><a href="" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(mymodel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-22-1.svg" class="r-stretch"></section>
<section id="model-mis-specification-1" class="slide level2">
<h2>Model mis-specification</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="" aria-hidden="true" tabindex="-1"></a>mymodel <span class="ot">&lt;-</span> <span class="fu">lmer</span>(ACE <span class="sc">~</span> visit <span class="sc">*</span> condition <span class="sc">+</span></span>
<span id="cb12-2"><a href="" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span> <span class="sc">|</span> ppt), <span class="at">data =</span> d3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-24-1.svg"></p>
</figure>
</div>
</div>
</div>
</div><div class="column fragment" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="" aria-hidden="true" tabindex="-1"></a>mymodel <span class="ot">&lt;-</span> <span class="fu">lmer</span>(ACE <span class="sc">~</span> visit <span class="sc">*</span> condition <span class="sc">+</span></span>
<span id="cb13-2"><a href="" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span> <span class="sc">+</span> visit <span class="sc">|</span> ppt), <span class="at">data =</span> d3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-26-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="modelling-a-different-form-of-relation" class="slide level2">
<h2>Modelling a different form of relation</h2>
<p><strong>Transformations</strong></p>
<ul>
<li><p>Transforming your outcome variable may result in a model with better looking assumption plots</p>
<ul>
<li>log(y)</li>
<li>1/y</li>
<li>sqrt(y)</li>
<li>forecast::BoxCox(y)</li>
</ul></li>
</ul>
</section>
<section id="modelling-a-different-form-of-relation-1" class="slide level2">
<h2>Modelling a different form of relation</h2>
<p><strong>Transformations</strong></p>
<ul>
<li>Transforming your outcome variable may result in a model with better looking assumption plots</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">lmer</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> c <span class="sc">+</span> </span>
<span id="cb14-2"><a href="" aria-hidden="true" tabindex="-1"></a>       (<span class="dv">1</span> <span class="sc">|</span> cluster), df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-29-1.svg"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">lmer</span>(forecast<span class="sc">::</span><span class="fu">BoxCox</span>(y,<span class="at">lambda=</span><span class="st">"auto"</span>) <span class="sc">~</span> x1 <span class="sc">+</span> c <span class="sc">+</span> </span>
<span id="cb15-2"><a href="" aria-hidden="true" tabindex="-1"></a>       (<span class="dv">1</span> <span class="sc">|</span> cluster), df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-31-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="modelling-a-different-form-of-relation-2" class="slide level2" data-visibility="uncounted">
<h2>Modelling a different form of relation</h2>
<p><strong>Transformations?</strong></p>
<ul>
<li>Transforming will often come at the expense of <strong>interpretability.</strong></li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">lmer</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> c <span class="sc">+</span> </span>
<span id="cb16-2"><a href="" aria-hidden="true" tabindex="-1"></a>       (<span class="dv">1</span> <span class="sc">|</span> cluster), df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)          x1           c 
      36.14        1.62       10.02 </code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">lmer</span>(forecast<span class="sc">::</span><span class="fu">BoxCox</span>(y,<span class="at">lambda=</span><span class="st">"auto"</span>) <span class="sc">~</span> x1 <span class="sc">+</span> c <span class="sc">+</span> </span>
<span id="cb18-2"><a href="" aria-hidden="true" tabindex="-1"></a>       (<span class="dv">1</span> <span class="sc">|</span> cluster), df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)          x1           c 
    1.73376     0.00686     0.04843 </code></pre>
</div>
</div>
</div></div>
<!-- # When things look wrong -->
<!-- ### __robustlmm__ -->
<!-- ```{r eval=FALSE} -->
<!-- mymodel <- lmer(ACE ~ visit * condition + (1 | ppt), data = d3) -->
<!-- summary(mymodel)$coefficients -->
<!-- ``` -->
<!-- ```{r eval=FALSE} -->
<!-- library(robustlmm) -->
<!-- mymodelr <- rlmer(ACE ~ visit * condition + (1 | ppt), data = d3) -->
<!-- summary(mymodelr)$coefficients -->
<!-- ``` -->
</section>
<section id="making-fewer-assumptions" class="slide level2">
<h2>Making fewer assumptions?</h2>
<p><strong>Bootstrap?</strong></p>
<p>basic idea:</p>
<ol type="1">
<li>do many many times:<br>
 a. take a sample (e.g.&nbsp;sample with replacement from your data, or simulated from your model parameters)<br>
 b. fit the model to the sample<br>
</li>
<li>then:<br>
 a. based on all the models fitted in step 1, obtain a distribution of parameter estimate of interest.<br>
 b. based on the bootstrap distribution from 2a, compute a confidence interval for estimate.<br>
 c.&nbsp;celebrate</li>
</ol>
</section>
<section id="making-fewer-assumptions-1" class="slide level2">
<h2>Making fewer assumptions?</h2>
<p><strong>Bootstrapping is not a panacea.</strong></p>
<p>If we’re worrying because our errors are a little non-normal or heteroskedastic, and if we have a large sample size, then bootstrapping can let us relax these assumptions.</p>
<p><br></p>
<p>💩 The “garbage in garbage out” principle always applies</p>
<ul>
<li>unrepresentative samples and misspecified models aren’t made any better by bootstrapping.</li>
</ul>
</section>
<section id="bootstrap-what-do-we-resample" class="slide level2">
<h2>Bootstrap: What do we (re)sample?</h2>
<ul>
<li>resample based on the estimated distributions of parameters?
<ul>
<li>explanatory variables fixed</li>
<li>model specification</li>
<li>distributions (e.g.&nbsp;<span class="math inline">\(\zeta \sim N(0,\sigma_{\zeta}),\,\, \varepsilon \sim N(0,\sigma_{\varepsilon})\)</span>)</li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>resample residuals<br>
<!-- - $y* = \hat{y} + \hat{\varepsilon}_{\textrm{sampled with replacement}}$ -->
<ul>
<li>explanatory variables fixed</li>
<li>model specification</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>resample cases
<ul>
<li>model specification
<ul>
<li><strong>But</strong> do we resample observations? clusters? both?</li>
</ul></li>
</ul></li>
</ul>
</div>
</section>
<section id="case-bootstrap" class="slide level2">
<h2>Case Bootstrap</h2>
<p><strong>NOT IMPLEMENTED FOR CROSSED STRUCTURES</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="" aria-hidden="true" tabindex="-1"></a>mymodel <span class="ot">&lt;-</span> <span class="fu">lmer</span>(ACE <span class="sc">~</span> visit <span class="sc">*</span> condition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> visit <span class="sc">|</span> ppt), <span class="at">data =</span> d3)</span>
<span id="cb20-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmeresampler)</span>
<span id="cb20-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># resample only the people, not their observations: </span></span>
<span id="cb20-5"><a href="" aria-hidden="true" tabindex="-1"></a>mymodelBScase <span class="ot">&lt;-</span> <span class="fu">bootstrap</span>(mymodel, <span class="at">.f =</span> fixef, </span>
<span id="cb20-6"><a href="" aria-hidden="true" tabindex="-1"></a>                           <span class="at">type =</span> <span class="st">"case"</span>, <span class="at">B =</span> <span class="dv">1000</span>, </span>
<span id="cb20-7"><a href="" aria-hidden="true" tabindex="-1"></a>                           <span class="at">resample =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns fragment">
<div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mymodelBScase, <span class="at">type =</span> <span class="st">"perc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
  term                       estimate  lower   upper type  level
  &lt;chr&gt;                         &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1 (Intercept)                  85.7   85.5   86.0    perc   0.95
2 visit                        -0.532 -0.666 -0.390  perc   0.95
3 conditionmindfulness         -0.298 -0.650  0.0736 perc   0.95
4 visit:conditionmindfulness    0.346  0.151  0.555  perc   0.95</code></pre>
</div>
</div>
<div style="font-size: .6em">
<p>For a discussion of different bootstrap methods for multilevel models, see Leeden R.., Meijer E., Busing F.M. (2008) Resampling Multilevel Models. In: Leeuw J.., Meijer E. (eds) Handbook of Multilevel Analysis. Springer, New York, NY. DOI: 10.1007/978-0-387-73186-5_11</p>
</div>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mymodelBScase, <span class="st">"visit*conditionmindfulness"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-39-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section></section>
<section>
<section id="case-diagnostics" class="title-slide slide level1 center" data-background-color="#88B04B">
<h1>Case Diagnostics</h1>

</section>
<section id="influence" class="slide level2">
<h2>Influence</h2>
<p>Just like standard <code>lm()</code>, observations can have unduly high influence on our model through a combination of high leverage and outlyingness.</p>

<img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-40-1.svg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="but-we-have-multiple-levels" class="slide level2">
<h2>but we have multiple levels…</h2>
<ul>
<li><p>Both observations (level 1 units) <strong>and</strong> clusters (level 2+ units) can be influential.</p></li>
<li><p>several packages, but current recommendations are <strong>HLMdiag</strong> and <strong>influence.ME</strong>.</p></li>
</ul>
</section>
<section id="level-1-influential-points" class="slide level2">
<h2>Level 1 influential points</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="" aria-hidden="true" tabindex="-1"></a>mymodel <span class="ot">&lt;-</span> <span class="fu">lmer</span>(ACE <span class="sc">~</span> visit <span class="sc">*</span> condition <span class="sc">+</span> </span>
<span id="cb24-2"><a href="" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span> <span class="sc">+</span> visit <span class="sc">|</span> ppt), <span class="at">data =</span> d3)</span>
<span id="cb24-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HLMdiag)</span>
<span id="cb24-6"><a href="" aria-hidden="true" tabindex="-1"></a>infl1 <span class="ot">&lt;-</span> <span class="fu">hlm_influence</span>(mymodel, <span class="at">level =</span> <span class="dv">1</span>)</span>
<span id="cb24-7"><a href="" aria-hidden="true" tabindex="-1"></a>infl2 <span class="ot">&lt;-</span> <span class="fu">hlm_influence</span>(mymodel, <span class="at">level =</span> <span class="st">"ppt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(infl1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "id"               "ACE"              "visit"            "condition"       
 [5] "ppt"              "cooksd"           "mdffits"          "covtrace"        
 [9] "covratio"         "leverage.overall"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="" aria-hidden="true" tabindex="-1"></a>infl1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 177 × 10
      id   ACE visit condition ppt      cooksd   mdffits covtrace covratio
   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;     &lt;fct&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1     1  84.5     1 control   PPT_1 0.0119    0.0116    0.0221       1.02
 2     2  85.6     2 control   PPT_1 0.0164    0.0162    0.0145       1.01
 3     3  84.5     3 control   PPT_1 0.00158   0.00156   0.00901      1.01
 4     4  83.1     4 control   PPT_1 0.00138   0.00137   0.00508      1.01
 5     5  82.3     5 control   PPT_1 0.00160   0.00159   0.00239      1.00
 6     6  83.3     6 control   PPT_1 0.000482  0.000482  0.000765     1.00
 7     7  80.9     7 control   PPT_1 0.000227  0.000227  0.000150     1.00
 8     8  81.9     8 control   PPT_1 0.000112  0.000112  0.000619     1.00
 9     9  81.5     9 control   PPT_1 0.000804  0.000802  0.00239      1.00
10    10  80.4    10 control   PPT_1 0.0000561 0.0000558 0.00595      1.01
# ℹ 167 more rows
# ℹ 1 more variable: leverage.overall &lt;dbl&gt;</code></pre>
</div>
</div>
</div></div>
</section>
<section id="level-1-influential-points-1" class="slide level2">
<h2>Level 1 influential points</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="" aria-hidden="true" tabindex="-1"></a>mymodel <span class="ot">&lt;-</span> <span class="fu">lmer</span>(ACE <span class="sc">~</span> visit <span class="sc">*</span> condition <span class="sc">+</span> </span>
<span id="cb29-2"><a href="" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span> <span class="sc">+</span> visit <span class="sc">|</span> ppt), <span class="at">data =</span> d3)</span>
<span id="cb29-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HLMdiag)</span>
<span id="cb29-6"><a href="" aria-hidden="true" tabindex="-1"></a>infl1 <span class="ot">&lt;-</span> <span class="fu">hlm_influence</span>(mymodel, <span class="at">level =</span> <span class="dv">1</span>)</span>
<span id="cb29-7"><a href="" aria-hidden="true" tabindex="-1"></a>infl2 <span class="ot">&lt;-</span> <span class="fu">hlm_influence</span>(mymodel, <span class="at">level =</span> <span class="st">"ppt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">dotplot_diag</span>(infl1<span class="sc">$</span>cooksd, <span class="at">cutoff =</span> <span class="st">"internal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-44-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="level-2-influential-clusters" class="slide level2">
<h2>Level 2 influential clusters</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="" aria-hidden="true" tabindex="-1"></a>mymodel <span class="ot">&lt;-</span> <span class="fu">lmer</span>(ACE <span class="sc">~</span> visit <span class="sc">*</span> condition <span class="sc">+</span> </span>
<span id="cb31-2"><a href="" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span> <span class="sc">+</span> visit <span class="sc">|</span> ppt), <span class="at">data =</span> d3)</span>
<span id="cb31-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HLMdiag)</span>
<span id="cb31-6"><a href="" aria-hidden="true" tabindex="-1"></a>infl1 <span class="ot">&lt;-</span> <span class="fu">hlm_influence</span>(mymodel, <span class="at">level =</span> <span class="dv">1</span>)</span>
<span id="cb31-7"><a href="" aria-hidden="true" tabindex="-1"></a>infl2 <span class="ot">&lt;-</span> <span class="fu">hlm_influence</span>(mymodel, <span class="at">level =</span> <span class="st">"ppt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">dotplot_diag</span>(infl2<span class="sc">$</span>cooksd, <span class="at">cutoff =</span> <span class="st">"internal"</span>, <span class="at">index=</span>infl2<span class="sc">$</span>ppt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">dotplot_diag</span>(infl2<span class="sc">$</span>cooksd, <span class="at">cutoff =</span> <span class="fl">0.201</span>, <span class="at">index=</span>infl2<span class="sc">$</span>ppt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-47-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="the-process-will-depend-on-the-design" class="slide level2">
<h2>The process will depend on the design</h2>
<ul>
<li><p>In this context (observations within participants) - it makes sense to think about level-2 (participant) <em>first</em>.</p></li>
<li><p>It’s worth looking into PPT_2 a bit further.</p></li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="" aria-hidden="true" tabindex="-1"></a>infl2 <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(cooksd)) <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  ppt    cooksd mdffits covtrace covratio leverage.overall
  &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt;
1 PPT_2  0.213   0.190     0.235     1.25            0.158
2 PPT_18 0.150   0.134     0.229     1.24            0.158
3 PPT_19 0.102   0.0918    0.229     1.24            0.158
4 PPT_5  0.0858  0.0771    0.235     1.25            0.158
5 PPT_13 0.0811  0.0727    0.229     1.24            0.158
6 PPT_3  0.0747  0.0670    0.235     1.25            0.158</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="" aria-hidden="true" tabindex="-1"></a>infl2 <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(mdffits)) <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  ppt    cooksd mdffits covtrace covratio leverage.overall
  &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt;
1 PPT_2  0.213   0.190     0.235     1.25            0.158
2 PPT_18 0.150   0.134     0.229     1.24            0.158
3 PPT_19 0.102   0.0918    0.229     1.24            0.158
4 PPT_5  0.0858  0.0771    0.235     1.25            0.158
5 PPT_13 0.0811  0.0727    0.229     1.24            0.158
6 PPT_3  0.0747  0.0670    0.235     1.25            0.158</code></pre>
</div>
</div>
<ul>
<li><code>mdffits</code> is a measure of multivariate “difference in fixed effects”</li>
</ul>
</div></div>
</section>
<section id="sensitivity-analysis" class="slide level2">
<h2>Sensitivity Analysis?</h2>
<p>“What would happen to my conclusions &amp; estimates if I …”</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="" aria-hidden="true" tabindex="-1"></a>mymodel <span class="ot">&lt;-</span> </span>
<span id="cb38-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(ACE <span class="sc">~</span> visit <span class="sc">*</span> condition <span class="sc">+</span> </span>
<span id="cb38-3"><a href="" aria-hidden="true" tabindex="-1"></a>         (<span class="dv">1</span> <span class="sc">+</span> visit <span class="sc">|</span> ppt), </span>
<span id="cb38-4"><a href="" aria-hidden="true" tabindex="-1"></a>       <span class="at">data =</span> d3)</span>
<span id="cb38-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mymodel, <span class="at">corr=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: ACE ~ visit * condition + (1 + visit | ppt)
   Data: d3

REML criterion at convergence: 362

Scaled residuals: 
   Min     1Q Median     3Q    Max 
-2.296 -0.686 -0.041  0.686  2.420 

Random effects:
 Groups   Name        Variance Std.Dev. Corr 
 ppt      (Intercept) 0.1467   0.383         
          visit       0.0769   0.277    -0.49
 Residual             0.2445   0.495         
Number of obs: 177, groups:  ppt, 20

Fixed effects:
                           Estimate Std. Error t value
(Intercept)                 85.7353     0.1688  507.79
visit                       -0.5319     0.0897   -5.93
conditionmindfulness        -0.2979     0.2362   -1.26
visit:conditionmindfulness   0.3459     0.1269    2.73</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="" aria-hidden="true" tabindex="-1"></a>mymodel_rm2 <span class="ot">&lt;-</span> </span>
<span id="cb40-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lmer</span>(ACE <span class="sc">~</span> visit <span class="sc">*</span> condition <span class="sc">+</span> </span>
<span id="cb40-3"><a href="" aria-hidden="true" tabindex="-1"></a>         (<span class="dv">1</span> <span class="sc">+</span> visit <span class="sc">|</span> ppt), </span>
<span id="cb40-4"><a href="" aria-hidden="true" tabindex="-1"></a>       <span class="at">data =</span> d3 <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span>ppt <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PPT_2"</span>)))</span>
<span id="cb40-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mymodel_rm2, <span class="at">corr=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: ACE ~ visit * condition + (1 + visit | ppt)
   Data: filter(d3, !ppt %in% c("PPT_2"))

REML criterion at convergence: 341

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.2678 -0.6644  0.0145  0.6289  2.6904 

Random effects:
 Groups   Name        Variance Std.Dev. Corr 
 ppt      (Intercept) 0.0715   0.267         
          visit       0.0804   0.284    -0.76
 Residual             0.2557   0.506         
Number of obs: 167, groups:  ppt, 19

Fixed effects:
                           Estimate Std. Error t value
(Intercept)                 85.8735     0.1537  558.54
visit                       -0.5251     0.0966   -5.44
conditionmindfulness        -0.4394     0.2094   -2.10
visit:conditionmindfulness   0.3394     0.1332    2.55</code></pre>
</div>
</div>
</div></div>
</section></section>
<section id="interim-summary" class="title-slide slide level1 center" data-background-color="white">
<h1>Interim Summary</h1>
<div>
<ul>
<li class="fragment"><p>Our assumptions for multilevel models are similar to the standard linear model - it’s about our <em>residuals</em></p>
<ul>
<li class="fragment">random effects are another level of residual</li>
</ul></li>
<li class="fragment"><p>“Influence” on models is exerted by both observations and clusters</p></li>
<li class="fragment"><p>Use plots and diagnostics to prod and probe your model.</p></li>
<li class="fragment"><p>first course of action should always be to THINK (i.e., about model specification)</p>
<ul>
<li class="fragment">only then (if desired) consider things like transformations, bootstrap etc.</li>
</ul></li>
<li class="fragment"><p>If in doubt, consider a sensitivity analysis: how do your conclusions change depending upon decisions you have made.</p></li>
</ul>
</div>
</section>

<section>
<section id="centering" class="title-slide slide level1 center" data-background-color="#88B04B">
<h1>Centering</h1>

</section>
<section id="centering-1" class="slide level2">
<h2>Centering</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Suppose we have a variable for which the mean is 100.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-52-1.svg"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>We can re-center this so that 100 (the mean) becomes zero:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-53-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="centering-2" class="slide level2" data-visibility="uncounted">
<h2>Centering</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Suppose we have a variable for which the mean is 100.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-54-1.svg"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>We can re-center this so that <em>any</em> value becomes zero:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-55-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="scaling" class="slide level2">
<h2>Scaling</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Suppose we have a variable for which the mean is 100. The standard deviation is 15</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-56-1.svg"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>We can scale this so that a change in 1 is equivalent to a change in 1 standard deviation:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-57-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="centering-predictors-in-lm" class="slide level2">
<h2>Centering predictors in LM</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x,<span class="at">data=</span>df)</span>
<span id="cb42-2"><a href="" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span><span class="fu">scale</span>(x, <span class="at">center=</span>T,<span class="at">scale=</span>F),<span class="at">data=</span>df)</span>
<span id="cb42-3"><a href="" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span><span class="fu">scale</span>(x, <span class="at">center=</span>T,<span class="at">scale=</span>T),<span class="at">data=</span>df)</span>
<span id="cb42-4"><a href="" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span><span class="fu">I</span>(x<span class="dv">-5</span>), <span class="at">data=</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment" data-fragment-index="1">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m1,m2,m3,m4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: y ~ x
Model 2: y ~ scale(x, center = T, scale = F)
Model 3: y ~ scale(x, center = T, scale = T)
Model 4: y ~ I(x - 5)
  Res.Df RSS Df Sum of Sq F Pr(&gt;F)
1    198 177                      
2    198 177  0 -2.84e-14         
3    198 177  0  0.00e+00         
4    198 177  0  0.00e+00         </code></pre>
</div>
</div>
</div>
</div><div class="column fragment" data-fragment-index="1" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-61-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="big-fish-little-fish" class="slide level2">
<h2>Big Fish Little Fish</h2>

<img data-src="img_sandbox/bigfishlittlefish.png" class="r-stretch"></section>
<section id="big-fish-little-fish-1" class="slide level2">
<h2>Big Fish Little Fish</h2>

<img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-63-1.svg" class="quarto-figure quarto-figure-center r-stretch"><p>data available at https://uoepsy.github.io/data/bflp.csv</p>
</section>
<section id="things-are-different-with-multi-level-data" class="slide level2">
<h2>Things are different with multi-level data</h2>

<img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-64-1.svg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="multiple-means" class="slide level2">
<h2>Multiple means</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Grand mean</strong></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-65-1.svg"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>Group means</strong></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-66-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="group-mean-centering" class="slide level2">
<h2>Group-mean centering</h2>
<p><br></p>

<img data-src="img_sandbox/center.gif" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="group-mean-centering-1" class="slide level2">
<h2>Group-mean centering</h2>
<div class="columns">
<div class="column" style="width:50%;">
<center>
<strong>Within group</strong><br> <strong><span class="math inline">\(x_{ij} - \bar{x}_i\)</span></strong>
</center>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-70-1.svg"></p>
</figure>
</div>
</div>
</div>
</div><div class="column fragment" style="width:50%;">
<center>
<strong>Between group</strong><br> <strong><span class="math inline">\(\bar{x}_i\)</span></strong>
</center>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-71-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="disaggregating-within-between" class="slide level2">
<h2>Disaggregating within &amp; between</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>RE model</strong><br>
<span class="math display">\[
\begin{align}
y_{ij} &amp;= b_{0i} + b_{1}(x_j) + \varepsilon_{ij} \\
b_{0i} &amp;= \gamma_{00} + \zeta_{0i} \\
... \\
\end{align}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="" aria-hidden="true" tabindex="-1"></a>mod_re <span class="ot">&lt;-</span> <span class="fu">lmer</span>(self_esteem <span class="sc">~</span> fish_weight <span class="sc">+</span> </span>
<span id="cb45-2"><a href="" aria-hidden="true" tabindex="-1"></a>              (<span class="dv">1</span> <span class="sc">|</span> pond), <span class="at">data=</span>bflp)</span>
<span id="cb45-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(mod_re)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) fish_weight 
     1.7616      0.0405 </code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>Within-between model</strong><br>
<span class="math display">\[
\begin{align}
y_{ij} &amp;= b_{0i} + b_{1}(\bar{x}_i) + b_2(x_{ij} - \bar{x}_i)+ \varepsilon_{ij} \\
b_{0i} &amp;= \gamma_{00} + \zeta_{0i} \\
... \\
\end{align}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="" aria-hidden="true" tabindex="-1"></a>bflp <span class="ot">&lt;-</span> </span>
<span id="cb47-2"><a href="" aria-hidden="true" tabindex="-1"></a>  bflp <span class="sc">|&gt;</span> <span class="fu">group_by</span>(pond) <span class="sc">|&gt;</span></span>
<span id="cb47-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb47-4"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="at">fw_between_pond =</span> <span class="fu">mean</span>(fish_weight),</span>
<span id="cb47-5"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="at">fw_within_pond =</span> fish_weight <span class="sc">-</span> <span class="fu">mean</span>(fish_weight)</span>
<span id="cb47-6"><a href="" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb47-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="" aria-hidden="true" tabindex="-1"></a>mod_wb <span class="ot">&lt;-</span> <span class="fu">lmer</span>(self_esteem <span class="sc">~</span> fw_between_pond <span class="sc">+</span> fw_within_pond <span class="sc">+</span> </span>
<span id="cb47-9"><a href="" aria-hidden="true" tabindex="-1"></a>              (<span class="dv">1</span> <span class="sc">|</span> pond), <span class="at">data=</span>bflp)</span>
<span id="cb47-10"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(mod_wb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    (Intercept) fw_between_pond  fw_within_pond 
         4.7680         -0.0559          0.0407 </code></pre>
</div>
</div>
</div></div>
</section>
<section id="disaggregating-within-between-1" class="slide level2">
<h2>Disaggregating within &amp; between</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-74-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>Within-between model</strong><br>
<span class="math display">\[
\begin{align}
y_{ij} &amp;= b_{0i} + b_{1}(\bar{x}_i) + b_2(x_{ij} - \bar{x}_i)+ \varepsilon_{ij} \\
b_{0i} &amp;= \gamma_{00} + \zeta_{0i} \\
... \\
\end{align}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="" aria-hidden="true" tabindex="-1"></a>bflp <span class="ot">&lt;-</span> </span>
<span id="cb49-2"><a href="" aria-hidden="true" tabindex="-1"></a>  bflp <span class="sc">|&gt;</span> <span class="fu">group_by</span>(pond) <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb49-4"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="at">fw_between_pond =</span> <span class="fu">mean</span>(fish_weight),</span>
<span id="cb49-5"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="at">fw_within_pond =</span> fish_weight <span class="sc">-</span> <span class="fu">mean</span>(fish_weight)</span>
<span id="cb49-6"><a href="" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb49-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="" aria-hidden="true" tabindex="-1"></a>mod_wb <span class="ot">&lt;-</span> <span class="fu">lmer</span>(self_esteem <span class="sc">~</span> fw_between_pond <span class="sc">+</span> fw_within_pond <span class="sc">+</span> </span>
<span id="cb49-9"><a href="" aria-hidden="true" tabindex="-1"></a>              (<span class="dv">1</span> <span class="sc">|</span> pond), <span class="at">data=</span>bflp)</span>
<span id="cb49-10"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(mod_wb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    (Intercept) fw_between_pond  fw_within_pond 
         4.7680         -0.0559          0.0407 </code></pre>
</div>
</div>
</div></div>
</section>
<section id="a-more-realistic-example" class="slide level2">
<h2>A more realistic example</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>A research study investigates how anxiety is associated with drinking habits. Data was collected from 50 participants. Researchers administered the generalised anxiety disorder (GAD-7) questionnaire to measure levels of anxiety over the past week, and collected information on the units of alcohol participants had consumed within the week. Each participant was observed on 10 different occasions.</p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-77-1.svg"></p>
</figure>
</div>
</div>
</div>
<p>data available at https://uoepsy.github.io/data/lmm_alcgad.csv</p>
</div></div>
</section>
<section id="a-more-realistic-example-1" class="slide level2">
<h2>A more realistic example</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>The Within Question</strong></p>
<p>Is being more anxious (than you usually are) associated with higher consumption of alcohol?</p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-78-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="a-more-realistic-example-2" class="slide level2">
<h2>A more realistic example</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>The Between Question</strong></p>
<p>Is being generally more anxious (relative to others) associated with higher consumption of alcohol?</p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-79-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="modelling-within-between-effects" class="slide level2">
<h2>Modelling within &amp; between effects</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="" aria-hidden="true" tabindex="-1"></a>alcgad <span class="ot">&lt;-</span> </span>
<span id="cb51-2"><a href="" aria-hidden="true" tabindex="-1"></a>  alcgad <span class="sc">|&gt;</span> <span class="fu">group_by</span>(ppt) <span class="sc">|&gt;</span></span>
<span id="cb51-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">gad_between =</span> <span class="fu">mean</span>(gad),</span>
<span id="cb51-5"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="at">gad_within =</span> gad <span class="sc">-</span> <span class="fu">mean</span>(gad)</span>
<span id="cb51-6"><a href="" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb51-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="" aria-hidden="true" tabindex="-1"></a>alcmod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(alcunits <span class="sc">~</span> gad_between <span class="sc">+</span> gad_within <span class="sc">+</span></span>
<span id="cb51-9"><a href="" aria-hidden="true" tabindex="-1"></a>                 (<span class="dv">1</span> <span class="sc">+</span> gad_within <span class="sc">|</span> ppt), </span>
<span id="cb51-10"><a href="" aria-hidden="true" tabindex="-1"></a>               <span class="at">data=</span>alcgad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(alcmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: alcunits ~ gad_between + gad_within + (1 + gad_within | ppt)
   Data: alcgad

REML criterion at convergence: 1424

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.8466 -0.6264  0.0642  0.6292  3.0281 

Random effects:
 Groups   Name        Variance Std.Dev. Corr 
 ppt      (Intercept) 3.7803   1.944         
          gad_within  0.0935   0.306    -0.30
 Residual             1.7234   1.313         
Number of obs: 375, groups:  ppt, 50

Fixed effects:
            Estimate Std. Error t value
(Intercept)  14.5802     0.8641   16.87
gad_between  -0.7584     0.1031   -7.35
gad_within    0.6378     0.0955    6.68

Correlation of Fixed Effects:
            (Intr) gd_btw
gad_between -0.945       
gad_within  -0.055  0.012</code></pre>
</div>
</div>
</div></div>
</section>
<section id="within-between-a-bit-of-both" class="slide level2">
<h2>within? between? a bit of both?</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="" aria-hidden="true" tabindex="-1"></a>alcmod2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(alcunits <span class="sc">~</span> gad <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> gad <span class="sc">|</span> ppt), </span>
<span id="cb54-2"><a href="" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>alcgad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(alcmod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: alcunits ~ gad + (1 + gad | ppt)
   Data: alcgad

REML criterion at convergence: 1492

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.9619 -0.6412  0.0227  0.5956  3.0251 

Random effects:
 Groups   Name        Variance Std.Dev. Corr 
 ppt      (Intercept) 15.1205  3.889         
          gad          0.0751  0.274    -0.37
 Residual              1.7750  1.332         
Number of obs: 375, groups:  ppt, 50

Fixed effects:
            Estimate Std. Error t value
(Intercept)   5.3937     0.8361    6.45
gad           0.4176     0.0877    4.76

Correlation of Fixed Effects:
    (Intr)
gad -0.772</code></pre>
</div>
</div>
</div></div>
</section>
<section id="within-between-effects" class="slide level2">
<h2>Within &amp; Between effects</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-85-1.svg"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-86-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="within-between-effects-1" class="slide level2">
<h2>Within &amp; Between effects</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-87-1.svg"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="04assumptions_files/figure-revealjs/unnamed-chunk-88-1.svg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="modelling-within-between-interactions" class="slide level2">
<h2>Modelling within &amp; between interactions</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="" aria-hidden="true" tabindex="-1"></a>alcmod.int <span class="ot">&lt;-</span> <span class="fu">lmer</span>(alcunits <span class="sc">~</span> intervention <span class="sc">*</span> </span>
<span id="cb57-2"><a href="" aria-hidden="true" tabindex="-1"></a>                     (gad_between <span class="sc">+</span> gad_within) <span class="sc">+</span></span>
<span id="cb57-3"><a href="" aria-hidden="true" tabindex="-1"></a>                     (<span class="dv">1</span> <span class="sc">|</span> ppt), </span>
<span id="cb57-4"><a href="" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>alcgad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(alcmod.int, <span class="at">corr=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: alcunits ~ intervention * (gad_between + gad_within) + (1 | ppt)
   Data: alcgad

REML criterion at convergence: 1404

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.8183 -0.6354  0.0142  0.5928  3.0874 

Random effects:
 Groups   Name        Variance Std.Dev.
 ppt      (Intercept) 3.59     1.9     
 Residual             1.69     1.3     
Number of obs: 375, groups:  ppt, 50

Fixed effects:
                         Estimate Std. Error t value
(Intercept)                14.858      1.275   11.65
intervention               -0.549      1.711   -0.32
gad_between                -0.876      0.154   -5.70
gad_within                  1.092      0.128    8.56
intervention:gad_between    0.205      0.205    1.00
intervention:gad_within    -0.757      0.166   -4.57</code></pre>
</div>
</div>
</div></div>
</section>
<section id="when-does-it-matter" class="slide level2">
<h2>When does it matter?</h2>
<p>When we have a predictor <span class="math inline">\(x\)</span> that varies <em>within</em> a cluster</p>
<p>and</p>
<p>When clusters have different average levels of <span class="math inline">\(x\)</span>. This typically only happens when <span class="math inline">\(x\)</span> is <em>observed</em> (as opposed to when it is manipulated as part of an experiment)</p>
<p>and</p>
<p>When our question concerns <span class="math inline">\(x\)</span>. (if <span class="math inline">\(x\)</span> is just a covariate, no need).</p>
</section></section>
<section>
<section id="summary" class="title-slide slide level1 center" data-background-color="white">
<h1>Summary</h1>
<div>
<ul>
<li class="fragment"><p>Applying the same linear transformation to a predictor (e.g.&nbsp;grand-mean centering, or standardising) makes <strong>no difference</strong> to our model or significance tests</p>
<ul>
<li class="fragment">it changes what we “get out” (i.e.&nbsp;intercept changes place, slopes change units).</li>
</ul></li>
<li class="fragment"><p>When data are clustered, we can apply group-level transformations, e.g.&nbsp;<strong>group-mean centering.</strong></p></li>
<li class="fragment"><p>Group-mean centering our predictors allows us to disaggregate <strong>within</strong> from <strong>between</strong> effects.</p>
<ul>
<li class="fragment">allowing us to ask the theoretical questions that we are actually interested in</li>
</ul></li>
</ul>
</div>
</section>
<section id="this-week-1" class="slide level2">
<h2>This week</h2>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="tasks">Tasks</h3>
<p><img data-src="img_sandbox/readings.png" style="margin:0;margin-left:-60px" width="60"> Complete readings</p>
<p><br></p>
<p><img data-src="img_sandbox/labs.svg" style="margin:0;margin-left:-60px" width="60"> Attend your lab and work together on the exercises</p>
<p><br></p>
<p><img data-src="img_sandbox/exam.svg" style="margin:0;margin-left:-60px" width="60"> Complete the weekly quiz</p>
</div><div class="column" style="width:50%;">
<h3 id="support">Support</h3>
<p><img data-src="img_sandbox/forum.svg" style="margin:0;margin-left:-60px" width="60"> Piazza forum!</p>
<p><br></p>
<p><img data-src="img_sandbox/oh.png" style="margin:0;margin-left:-60px" width="60"> Office hours (see Learn page for details)</p>
</div></div>

</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="04assumptions_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="04assumptions_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="04assumptions_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="04assumptions_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="04assumptions_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="04assumptions_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="04assumptions_files/libs/revealjs/plugin/reveal-attribution/attribution.js"></script>
  <script src="04assumptions_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="04assumptions_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="04assumptions_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="04assumptions_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="04assumptions_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1500,

        height: 1000,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, RevealAttribution, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <style>

      .hide {

        display: none !important;

      }

    </style>

    

    

    <script>

      function remove() {

        let footer = document.querySelector('div.footer');

        let slideNo = document.querySelector('div.slide-number');

        slideNo.classList.add('hide');

        footer.classList.add('hide');

      

        Reveal.on('slidechanged', event => {  

          if(Reveal.isFirstSlide()) {

            slideNo.classList.add('hide');

            footer.classList.add('hide');

          } else {

            slideNo.classList.remove('hide');

            footer.classList.remove('hide');

          }

        });

      }

      

      window.onload = remove();

    </script>

    <iframe id="overlayIframe" class="overlay-iframe" title="Overlay content"></iframe>

    <!-- Close button for overlay -->

    <button id="overlayClose" class="overlay-close" title="Close overlay"></button>

    <script>

      // Grab elements

      const overlayIframe = document.getElementById('overlayIframe');

      const overlayClose  = document.getElementById('overlayClose');

    

      // Show overlay

      function showOverlay(src) {

        overlayIframe.src = src;

        overlayIframe.classList.add('visible');

        overlayClose.classList.add('visible');

      }

    

      // Hide overlay

      function hideOverlay() {

        overlayIframe.classList.remove('visible');

        overlayClose.classList.remove('visible');

        setTimeout(() => {

          if (!overlayIframe.classList.contains('visible')) {

            overlayIframe.src = 'about:blank';

          }

        }, 300);

      }

    

      // Trigger overlay on click

      document.addEventListener('click', function (e) {

        if (e.target.classList.contains('iframe-trigger')) {

          const src = e.target.getAttribute('data-src');

          if (src) showOverlay(src);

        }

      });

    

      // Close button

      overlayClose.addEventListener('click', hideOverlay);

    

      // Key handling

      document.addEventListener('keydown', function (e) {

        if (overlayIframe.classList.contains('visible')) {

          if (e.key === 'Escape') {

            // Only intercept ESC when overlay is open

            e.preventDefault();

            hideOverlay();

          } else if (["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," "].includes(e.key)) {

            // Block navigation keys *only* while overlay is visible

            e.preventDefault();

          }

          // Do NOT stopPropagation — let Reveal update UI (slide numbers etc.)

        }

      });

    </script>

    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
          let selectedAnnoteEl;
          const selectorForAnnotation = ( cell, annotation) => {
            let cellAttr = 'data-code-cell="' + cell + '"';
            let lineAttr = 'data-code-annotation="' +  annotation + '"';
            const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
            return selector;
          }
          const selectCodeLines = (annoteEl) => {
            const doc = window.document;
            const targetCell = annoteEl.getAttribute("data-target-cell");
            const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
            const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            const lines = annoteSpan.getAttribute("data-code-lines").split(",");
            const lineIds = lines.map((line) => {
              return targetCell + "-" + line;
            })
            let top = null;
            let height = null;
            let parent = null;
            if (lineIds.length > 0) {
                //compute the position of the single el (top and bottom and make a div)
                const el = window.document.getElementById(lineIds[0]);
                top = el.offsetTop;
                height = el.offsetHeight;
                parent = el.parentElement.parentElement;
              if (lineIds.length > 1) {
                const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                height = bottom - top;
              }
              if (top !== null && height !== null && parent !== null) {
                // cook up a div (if necessary) and position it 
                let div = window.document.getElementById("code-annotation-line-highlight");
                if (div === null) {
                  div = window.document.createElement("div");
                  div.setAttribute("id", "code-annotation-line-highlight");
                  div.style.position = 'absolute';
                  parent.appendChild(div);
                }
                div.style.top = top - 2 + "px";
                div.style.height = height + 4 + "px";
                div.style.left = 0;
                let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                if (gutterDiv === null) {
                  gutterDiv = window.document.createElement("div");
                  gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                  gutterDiv.style.position = 'absolute';
                  const codeCell = window.document.getElementById(targetCell);
                  const gutter = codeCell.querySelector('.code-annotation-gutter');
                  gutter.appendChild(gutterDiv);
                }
                gutterDiv.style.top = top - 2 + "px";
                gutterDiv.style.height = height + 4 + "px";
              }
              selectedAnnoteEl = annoteEl;
            }
          };
          const unselectCodeLines = () => {
            const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
            elementsIds.forEach((elId) => {
              const div = window.document.getElementById(elId);
              if (div) {
                div.remove();
              }
            });
            selectedAnnoteEl = undefined;
          };
            // Handle positioning of the toggle
        window.addEventListener(
          "resize",
          throttle(() => {
            elRect = undefined;
            if (selectedAnnoteEl) {
              selectCodeLines(selectedAnnoteEl);
            }
          }, 10)
        );
        function throttle(fn, ms) {
        let throttle = false;
        let timer;
          return (...args) => {
            if(!throttle) { // first call gets through
                fn.apply(this, args);
                throttle = true;
            } else { // all the others get throttled
                if(timer) clearTimeout(timer); // cancel #2
                timer = setTimeout(() => {
                  fn.apply(this, args);
                  timer = throttle = false;
                }, ms);
            }
          };
        }
          const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
          for (let i=0; i<annoteTargets.length; i++) {
            const annoteTarget = annoteTargets[i];
            const targetCell = annoteTarget.getAttribute("data-target-cell");
            const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
            const contentFn = () => {
              const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
              if (content) {
                const tipContent = content.cloneNode(true);
                tipContent.classList.add("code-annotation-tip-content");
                return tipContent.outerHTML;
              }
            }
            const config = {
              allowHTML: true,
              content: contentFn,
              onShow: (instance) => {
                selectCodeLines(instance.reference);
                instance.reference.classList.add('code-annotation-active');
                window.tippy.hideAll();
              },
              onHide: (instance) => {
                unselectCodeLines();
                instance.reference.classList.remove('code-annotation-active');
              },
              maxWidth: 300,
              delay: [50, 0],
              duration: [200, 0],
              offset: [5, 10],
              arrow: true,
              appendTo: function(el) {
                return el.parentElement.parentElement.parentElement;
              },
              interactive: true,
              interactiveBorder: 10,
              theme: 'light-border',
              placement: 'right',
              popperOptions: {
                modifiers: [
                {
                  name: 'flip',
                  options: {
                    flipVariations: false, // true by default
                    allowedAutoPlacements: ['right'],
                    fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                  },
                },
                {
                  name: 'preventOverflow',
                  options: {
                    mainAxis: false,
                    altAxis: false
                  }
                }
                ]        
              }      
            };
            window.tippy(annoteTarget, config); 
          }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>