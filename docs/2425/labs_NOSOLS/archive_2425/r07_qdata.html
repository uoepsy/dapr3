<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R7: Questionnaire Data Wrangling – DAPR3 Lab Exercises</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>

function toggle_visibility(id1, id2) {

var e = document.getElementById(id1);

var f = document.getElementById(id2);

e.style.display = ((e.style.display!='none') ? 'none' : 'block');

if(f.classList.contains('jk-circle-right')) {

    f.classList.add('jk-circle-down')

    f.classList.remove('jk-circle-right')

} else {

    f.classList.add('jk-circle-right')

    f.classList.remove('jk-circle-down')

}

}

</script>

<link href="../site_libs/panelset-0.3.0/panelset.css" rel="stylesheet">

<script src="../site_libs/panelset-0.3.0/panelset.js"></script>

<link rel="stylesheet" href="https://uoepsy.github.io/assets/css/ccfooter.css">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      DAPR3 Lab Exercises
      </li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">DAPR3 Lab Exercises</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00prereq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prerequisites</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">W1 Exercises: Regression Refresher</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">W2 Exercises: Introducing MLM</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">W3 Exercises: Nested and Crossed Structures</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">W4 Exercises: Centering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">W5 Exercises: Bringing it all together</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">- break week -</span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 7</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r07_qdata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R7: Questionnaire Data Wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">W7 Exercises: Questionnaire Data &amp; Scale Scores</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 8</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r08_pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R8: Principal Component Analysis (PCA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">W8 Exercises: PCA</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 9</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r09_efa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R9: Exploratory Factor Analysis (EFA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../09ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">W9 Exercises: EFA</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 10</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../10ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">W10 Exercises: EFA, replicability, reliability</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 11</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../11ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">W11 Exercises</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#variable-names" id="toc-variable-names" class="nav-link active" data-scroll-target="#variable-names">Variable names</a></li>
  <li><a href="#variable-recoding" id="toc-variable-recoding" class="nav-link" data-scroll-target="#variable-recoding">Variable recoding</a></li>
  <li><a href="#applying-the-same-operation-across-variables" id="toc-applying-the-same-operation-across-variables" class="nav-link" data-scroll-target="#applying-the-same-operation-across-variables">Applying the same operation across variables</a></li>
  <li><a href="#reverse-coding" id="toc-reverse-coding" class="nav-link" data-scroll-target="#reverse-coding">Reverse coding</a></li>
  <li><a href="#row-scoring" id="toc-row-scoring" class="nav-link" data-scroll-target="#row-scoring">Row scoring</a></li>
  <li><a href="#more-rowwise-stuff" id="toc-more-rowwise-stuff" class="nav-link" data-scroll-target="#more-rowwise-stuff">More Rowwise Stuff</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">R7: Questionnaire Data Wrangling</h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<p>Questionnaire data often comes to us in ‘wide’ format, which is often how we want it for many of the analytical methods we use with questionnaire data. However, working with data in the wide format comes with some specific challenges that generally arise because we have lots and lots of variables.</p>
<p>Below we will walk through some of the common ways we want to wrangle and clean questionnaire data.</p>
<section id="variable-names" class="level1">
<h1>Variable names</h1>
<p>Very often, the data might come to us with huge long names that correspond to the question being asked.<br>
For instance:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://uoepsy.github.io/data/surveywrangle.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(survdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 53
    ppt   age height `[I am the life of the party.]` [I feel little concern fo…¹
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;                           &lt;chr&gt;                      
1     1    22    168 Moderately Accurate             Very Inaccurate            
2     2    29    186 Neither Accurate nor Inaccurate Moderately Inaccurate      
3     3    24     NA Very Inaccurate                 Very Inaccurate            
4     4    26    175 Very Inaccurate                 Moderately Inaccurate      
5     5    28    182 Very Inaccurate                 Very Inaccurate            
6     6    27    159 Moderately Accurate             Very Inaccurate            
# ℹ abbreviated name: ¹​`[I feel little concern for others.]`
# ℹ 48 more variables: `[I am always prepared.]` &lt;chr&gt;,
#   `[I get stressed out easily.]` &lt;chr&gt;, `[I have a rich vocabulary.]` &lt;chr&gt;,
#   `[I don't talk a lot.]` &lt;chr&gt;, `[I am interested in people.]` &lt;chr&gt;,
#   `[I leave my belongings around.]` &lt;chr&gt;,
#   `[I am relaxed most of the time.]` &lt;chr&gt;,
#   `[I have difficulty understanding abstract ideas.]` &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>Often, we want our variables to have some easier names to work with, e.g.&nbsp;“q1”, “q2” etc.</p>
<p>Because it’s often important to keep track of what each question actually asks, it can be useful to create a little dictionary to map our new variable names to the current names.</p>
<p>In our data, we have variables called <code>ppt</code>, <code>age</code> and <code>height</code>, and then 50 variables corresponding to 50 different questions.<br>
What I plan to do is rename them to <code>ppt</code>,<code>age</code>,<code>height</code>,<code>q1</code>, <code>q2</code>, …, <code>q50</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
what do <code>paste()/paste0()</code> do?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The <code>paste</code> functions allow us to simply “paste” characters together:<br>
By default, <code>paste()</code> will separate these with a space:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"i have a dog called"</span>, <span class="st">"dougal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "i have a dog called dougal"</code></pre>
</div>
</div>
<p>and <code>paste0()</code> will not separate them by anything:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"i have a dog called"</span>, <span class="st">"dougal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "i have a dog calleddougal"</code></pre>
</div>
</div>
<p>We can paste the same thing to a set of things:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"i have a dog called"</span>, <span class="fu">c</span>(<span class="st">"dougal"</span>, <span class="st">"rufus"</span>,<span class="st">"rosie"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "i have a dog called dougal" "i have a dog called rufus" 
[3] "i have a dog called rosie" </code></pre>
</div>
</div>
<p>Which can be useful for quickly making a set of variable names:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"item_"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "item_1"  "item_2"  "item_3"  "item_4"  "item_5"  "item_6"  "item_7" 
 [8] "item_8"  "item_9"  "item_10"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>datadict <span class="ot">&lt;-</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># these are my proposed new names</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"ppt"</span>,<span class="st">"age"</span>,<span class="st">"height"</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">paste0</span>(<span class="st">"q"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># current names</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">question =</span> <span class="fu">names</span>(survdat)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(datadict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  variable question                           
  &lt;chr&gt;    &lt;chr&gt;                              
1 ppt      ppt                                
2 age      age                                
3 height   height                             
4 q1       [I am the life of the party.]      
5 q2       [I feel little concern for others.]
6 q3       [I am always prepared.]            </code></pre>
</div>
</div>
<p>If we want to, we can write this to a .csv file so that we can keep it somewhere useful.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(datadict, <span class="at">file =</span> <span class="st">"survey_dictionary.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have created our record, we can actually change the names of the variables:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(survdat)[<span class="dv">4</span><span class="sc">:</span><span class="dv">53</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"q"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(survdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 53
    ppt   age height q1    q2    q3    q4    q5    q6    q7    q8    q9    q10  
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1     1    22    168 Mode… Very… Mode… Mode… Neit… Mode… Mode… Mode… Mode… Neit…
2     2    29    186 Neit… Mode… Mode… Neit… Mode… Mode… Mode… Mode… Neit… Neit…
3     3    24     NA Very… Very… Neit… Mode… Mode… Mode… Mode… Neit… Mode… Very…
4     4    26    175 Very… Mode… Mode… Mode… Very… Mode… Mode… Mode… Mode… Mode…
5     5    28    182 Very… Very… Neit… Mode… Mode… Very… Neit… Neit… Mode… Mode…
6     6    27    159 Mode… Very… Mode… Very… Very… Neit… Mode… Very… Neit… Mode…
# ℹ 40 more variables: q11 &lt;chr&gt;, q12 &lt;chr&gt;, q13 &lt;chr&gt;, q14 &lt;chr&gt;, q15 &lt;chr&gt;,
#   q16 &lt;chr&gt;, q17 &lt;chr&gt;, q18 &lt;chr&gt;, q19 &lt;chr&gt;, q20 &lt;chr&gt;, q21 &lt;chr&gt;,
#   q22 &lt;chr&gt;, q23 &lt;chr&gt;, q24 &lt;chr&gt;, q25 &lt;chr&gt;, q26 &lt;chr&gt;, q27 &lt;chr&gt;,
#   q28 &lt;chr&gt;, q29 &lt;chr&gt;, q30 &lt;chr&gt;, q31 &lt;chr&gt;, q32 &lt;chr&gt;, q33 &lt;chr&gt;,
#   q34 &lt;chr&gt;, q35 &lt;chr&gt;, q36 &lt;chr&gt;, q37 &lt;chr&gt;, q38 &lt;chr&gt;, q39 &lt;chr&gt;,
#   q40 &lt;chr&gt;, q41 &lt;chr&gt;, q42 &lt;chr&gt;, q43 &lt;chr&gt;, q44 &lt;chr&gt;, q45 &lt;chr&gt;,
#   q46 &lt;chr&gt;, q47 &lt;chr&gt;, q48 &lt;chr&gt;, q49 &lt;chr&gt;, q50 &lt;chr&gt;</code></pre>
</div>
</div>
<div class="divider div-transparent div-dot">

</div>
</section>
<section id="variable-recoding" class="level1">
<h1>Variable recoding</h1>
<p>First things first, all of the questions are scored on a 5 point likert<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> scale.</p>
<p>The data has come out of whatever questionnaire software we used and it’s showing the chosen response for each question in words, e.g.&nbsp;“Moderately Accurate”. But we are going to turn them into numbers so that they are easier to work with.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="botmraplwy" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#botmraplwy table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#botmraplwy thead, #botmraplwy tbody, #botmraplwy tfoot, #botmraplwy tr, #botmraplwy td, #botmraplwy th {
  border-style: none;
}

#botmraplwy p {
  margin: 0;
  padding: 0;
}

#botmraplwy .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#botmraplwy .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#botmraplwy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#botmraplwy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#botmraplwy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#botmraplwy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#botmraplwy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#botmraplwy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#botmraplwy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#botmraplwy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#botmraplwy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#botmraplwy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#botmraplwy .gt_spanner_row {
  border-bottom-style: hidden;
}

#botmraplwy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#botmraplwy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#botmraplwy .gt_from_md > :first-child {
  margin-top: 0;
}

#botmraplwy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#botmraplwy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#botmraplwy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#botmraplwy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#botmraplwy .gt_row_group_first td {
  border-top-width: 2px;
}

#botmraplwy .gt_row_group_first th {
  border-top-width: 2px;
}

#botmraplwy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#botmraplwy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#botmraplwy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#botmraplwy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#botmraplwy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#botmraplwy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#botmraplwy .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#botmraplwy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#botmraplwy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#botmraplwy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#botmraplwy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#botmraplwy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#botmraplwy .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#botmraplwy .gt_left {
  text-align: left;
}

#botmraplwy .gt_center {
  text-align: center;
}

#botmraplwy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#botmraplwy .gt_font_normal {
  font-weight: normal;
}

#botmraplwy .gt_font_bold {
  font-weight: bold;
}

#botmraplwy .gt_font_italic {
  font-style: italic;
}

#botmraplwy .gt_super {
  font-size: 65%;
}

#botmraplwy .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#botmraplwy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#botmraplwy .gt_indent_1 {
  text-indent: 5px;
}

#botmraplwy .gt_indent_2 {
  text-indent: 10px;
}

#botmraplwy .gt_indent_3 {
  text-indent: 15px;
}

#botmraplwy .gt_indent_4 {
  text-indent: 20px;
}

#botmraplwy .gt_indent_5 {
  text-indent: 25px;
}

#botmraplwy .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#botmraplwy div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="response" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">response</th>
<th id="score" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">score</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="response">Very Inaccurate</td>
<td class="gt_row gt_right" headers="score">1</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="response">Moderately Inaccurate</td>
<td class="gt_row gt_right" headers="score">2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="response">Neither Accurate nor Inaccurate</td>
<td class="gt_row gt_right" headers="score">3</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="response">Moderately Accurate</td>
<td class="gt_row gt_right" headers="score">4</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="response">Very Accurate</td>
<td class="gt_row gt_right" headers="score">5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You might be shouting at the screen here that by turning these words into numbers we’re about to turn a set of ordered categories into an interval scale. Is “Moderately Inaccurate” really 2 x “Very Inaccurate”? You might be right to have this intuition - it’s a contentious issue! In psychology, in which questionnaire based methods are everywhere, an often used rule of thumb is that likert data with <span class="math inline">\(\geq 5\)</span> levels can be treated as if they are continuous without unduly influencing results (see <a href="https://discovered.ed.ac.uk/permalink/f/1s15qcp/TN_cdi_crossref_primary_10_2307_2095231" target="_blank">Johnson, D.R., &amp; Creech, J.C. (1983). Ordinal measures in multiple indicator models: A simulation study of categorization error</a>).</p>
<p>Let’s push on and see how we can do this sort of recoding.<br>
First we’ll do it for just one variable. As always in R, there are lots of ways to do the same thing. All of these approaches follows an if-else type logic - “if we have ‘moderately inaccurate’, make it ‘2’, and if we have ’very inaccurate, make it 1, and if …”.</p>
<div class="panelset">
<section id="ifelse" class="level4 panel">
<h4 class="anchored" data-anchor-id="ifelse">ifelse()</h4>
<p>This is the most cumbersome way to do this logic as it requires multiple nested ifelse statements.<br>
To ensure that anything that isn’t one of the 5 valid response options gets to be an NA, we have the final “else” specifying that if it’s none of the prespecified options, make it an NA</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">q1 =</span> <span class="fu">ifelse</span>(q1 <span class="sc">==</span> <span class="st">"Very Inaccurate"</span>, <span class="dv">1</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>(q1 <span class="sc">==</span> <span class="st">"Moderately Inaccurate"</span>, <span class="dv">2</span>, </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>( q1 <span class="sc">==</span> <span class="st">"Neither Accurate nor Inaccurate"</span>, <span class="dv">3</span>, </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">ifelse</span>(q1 <span class="sc">==</span> <span class="st">"Moderately Accurate"</span>, <span class="dv">4</span>, </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">ifelse</span>(q1 <span class="sc">==</span> <span class="st">"Very Accurate"</span>, <span class="dv">5</span>, <span class="cn">NA</span>)))))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 53
     ppt   age height    q1 q2         q3    q4    q5    q6    q7    q8    q9   
   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1     1    22    168     4 Very Inac… Mode… Mode… Neit… Mode… Mode… Mode… Mode…
 2     2    29    186     3 Moderatel… Mode… Neit… Mode… Mode… Mode… Mode… Neit…
 3     3    24     NA     1 Very Inac… Neit… Mode… Mode… Mode… Mode… Neit… Mode…
 4     4    26    175     1 Moderatel… Mode… Mode… Very… Mode… Mode… Mode… Mode…
 5     5    28    182     1 Very Inac… Neit… Mode… Mode… Very… Neit… Neit… Mode…
 6     6    27    159     4 Very Inac… Mode… Very… Very… Neit… Mode… Very… Neit…
 7     7    27    149     2 Very Inac… Mode… Very… Mode… Mode… Mode… Mode… Neit…
 8     8    23    178     2 Neither A… Very… Very… Neit… Neit… Mode… Very… Very…
 9     9    28    176     3 Moderatel… Very… Very… Very… Neit… Very… Neit… Neit…
10    10    26    192     3 Very Inac… Mode… Mode… Mode… Neit… Mode… Mode… Mode…
# ℹ 66 more rows
# ℹ 41 more variables: q10 &lt;chr&gt;, q11 &lt;chr&gt;, q12 &lt;chr&gt;, q13 &lt;chr&gt;, q14 &lt;chr&gt;,
#   q15 &lt;chr&gt;, q16 &lt;chr&gt;, q17 &lt;chr&gt;, q18 &lt;chr&gt;, q19 &lt;chr&gt;, q20 &lt;chr&gt;,
#   q21 &lt;chr&gt;, q22 &lt;chr&gt;, q23 &lt;chr&gt;, q24 &lt;chr&gt;, q25 &lt;chr&gt;, q26 &lt;chr&gt;,
#   q27 &lt;chr&gt;, q28 &lt;chr&gt;, q29 &lt;chr&gt;, q30 &lt;chr&gt;, q31 &lt;chr&gt;, q32 &lt;chr&gt;,
#   q33 &lt;chr&gt;, q34 &lt;chr&gt;, q35 &lt;chr&gt;, q36 &lt;chr&gt;, q37 &lt;chr&gt;, q38 &lt;chr&gt;,
#   q39 &lt;chr&gt;, q40 &lt;chr&gt;, q41 &lt;chr&gt;, q42 &lt;chr&gt;, q43 &lt;chr&gt;, q44 &lt;chr&gt;, …</code></pre>
</div>
</div>
</section>
<section id="case_when" class="level4 panel">
<h4 class="anchored" data-anchor-id="case_when">case_when</h4>
<p><code>case_when()</code> follows this same logic as <code>ifelse()</code> but makes for easier reading (and writing). Each line is a statement saying “if [variable] is equal to [value], then return [new value]”. The final entry here <code>TRUE ~ NA</code> is a bit like saying “and if it is anything else, make it an NA”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">q1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>      q1 <span class="sc">==</span> <span class="st">"Very Inaccurate"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>      q1 <span class="sc">==</span> <span class="st">"Moderately Inaccurate"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>      q1 <span class="sc">==</span> <span class="st">"Neither Accurate nor Inaccurate"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>      q1 <span class="sc">==</span> <span class="st">"Moderately Accurate"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>      q1 <span class="sc">==</span> <span class="st">"Very Accurate"</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 53
     ppt   age height    q1 q2         q3    q4    q5    q6    q7    q8    q9   
   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1     1    22    168     4 Very Inac… Mode… Mode… Neit… Mode… Mode… Mode… Mode…
 2     2    29    186     3 Moderatel… Mode… Neit… Mode… Mode… Mode… Mode… Neit…
 3     3    24     NA     1 Very Inac… Neit… Mode… Mode… Mode… Mode… Neit… Mode…
 4     4    26    175     1 Moderatel… Mode… Mode… Very… Mode… Mode… Mode… Mode…
 5     5    28    182     1 Very Inac… Neit… Mode… Mode… Very… Neit… Neit… Mode…
 6     6    27    159     4 Very Inac… Mode… Very… Very… Neit… Mode… Very… Neit…
 7     7    27    149     2 Very Inac… Mode… Very… Mode… Mode… Mode… Mode… Neit…
 8     8    23    178     2 Neither A… Very… Very… Neit… Neit… Mode… Very… Very…
 9     9    28    176     3 Moderatel… Very… Very… Very… Neit… Very… Neit… Neit…
10    10    26    192     3 Very Inac… Mode… Mode… Mode… Neit… Mode… Mode… Mode…
# ℹ 66 more rows
# ℹ 41 more variables: q10 &lt;chr&gt;, q11 &lt;chr&gt;, q12 &lt;chr&gt;, q13 &lt;chr&gt;, q14 &lt;chr&gt;,
#   q15 &lt;chr&gt;, q16 &lt;chr&gt;, q17 &lt;chr&gt;, q18 &lt;chr&gt;, q19 &lt;chr&gt;, q20 &lt;chr&gt;,
#   q21 &lt;chr&gt;, q22 &lt;chr&gt;, q23 &lt;chr&gt;, q24 &lt;chr&gt;, q25 &lt;chr&gt;, q26 &lt;chr&gt;,
#   q27 &lt;chr&gt;, q28 &lt;chr&gt;, q29 &lt;chr&gt;, q30 &lt;chr&gt;, q31 &lt;chr&gt;, q32 &lt;chr&gt;,
#   q33 &lt;chr&gt;, q34 &lt;chr&gt;, q35 &lt;chr&gt;, q36 &lt;chr&gt;, q37 &lt;chr&gt;, q38 &lt;chr&gt;,
#   q39 &lt;chr&gt;, q40 &lt;chr&gt;, q41 &lt;chr&gt;, q42 &lt;chr&gt;, q43 &lt;chr&gt;, q44 &lt;chr&gt;, …</code></pre>
</div>
</div>
</section>
<section id="case_match" class="level4 panel">
<h4 class="anchored" data-anchor-id="case_match">case_match()</h4>
<p>The <code>ifelse()</code> and <code>case_when()</code> functions are much more generalised - we can say “if x is 1 make it 1, and if y is 2 make it 0, and if z is …”.</p>
<p>However, in the task at hand, all of our “if” questions apply to the value of the same variable. The <code>case_match()</code> function is perfectly designed for this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">q1 =</span> <span class="fu">case_match</span>(q1, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Very Inaccurate"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Moderately Inaccurate"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Neither Accurate nor Inaccurate"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Moderately Accurate"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Very Accurate"</span> <span class="sc">~</span> <span class="dv">5</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 53
     ppt   age height    q1 q2         q3    q4    q5    q6    q7    q8    q9   
   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1     1    22    168     4 Very Inac… Mode… Mode… Neit… Mode… Mode… Mode… Mode…
 2     2    29    186     3 Moderatel… Mode… Neit… Mode… Mode… Mode… Mode… Neit…
 3     3    24     NA     1 Very Inac… Neit… Mode… Mode… Mode… Mode… Neit… Mode…
 4     4    26    175     1 Moderatel… Mode… Mode… Very… Mode… Mode… Mode… Mode…
 5     5    28    182     1 Very Inac… Neit… Mode… Mode… Very… Neit… Neit… Mode…
 6     6    27    159     4 Very Inac… Mode… Very… Very… Neit… Mode… Very… Neit…
 7     7    27    149     2 Very Inac… Mode… Very… Mode… Mode… Mode… Mode… Neit…
 8     8    23    178     2 Neither A… Very… Very… Neit… Neit… Mode… Very… Very…
 9     9    28    176     3 Moderatel… Very… Very… Very… Neit… Very… Neit… Neit…
10    10    26    192     3 Very Inac… Mode… Mode… Mode… Neit… Mode… Mode… Mode…
# ℹ 66 more rows
# ℹ 41 more variables: q10 &lt;chr&gt;, q11 &lt;chr&gt;, q12 &lt;chr&gt;, q13 &lt;chr&gt;, q14 &lt;chr&gt;,
#   q15 &lt;chr&gt;, q16 &lt;chr&gt;, q17 &lt;chr&gt;, q18 &lt;chr&gt;, q19 &lt;chr&gt;, q20 &lt;chr&gt;,
#   q21 &lt;chr&gt;, q22 &lt;chr&gt;, q23 &lt;chr&gt;, q24 &lt;chr&gt;, q25 &lt;chr&gt;, q26 &lt;chr&gt;,
#   q27 &lt;chr&gt;, q28 &lt;chr&gt;, q29 &lt;chr&gt;, q30 &lt;chr&gt;, q31 &lt;chr&gt;, q32 &lt;chr&gt;,
#   q33 &lt;chr&gt;, q34 &lt;chr&gt;, q35 &lt;chr&gt;, q36 &lt;chr&gt;, q37 &lt;chr&gt;, q38 &lt;chr&gt;,
#   q39 &lt;chr&gt;, q40 &lt;chr&gt;, q41 &lt;chr&gt;, q42 &lt;chr&gt;, q43 &lt;chr&gt;, q44 &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>If we wanted to collapse levels, the syntax works like so:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">q1 =</span> <span class="fu">case_match</span>(q1, </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">c</span>(<span class="st">"Very Inaccurate"</span>,<span class="st">"Moderately Inaccurate"</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Neither Accurate nor Inaccurate"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">c</span>(<span class="st">"Moderately Accurate"</span>,<span class="st">"Very Accurate"</span>) <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
<div class="divider div-transparent div-dot">

</div>
</section>
<section id="applying-the-same-operation-across-variables" class="level1">
<h1>Applying the same operation across variables</h1>
<p>Now that we know how to recode a variable, what if we want to do it for all 50 questions? We don’t want to do it manually, because that would be hugely inefficient:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">q1 =</span> <span class="fu">case_match</span>(q1,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    ..</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">q2 =</span> <span class="fu">case_match</span>(q2,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    ..</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  ..</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are various ways to do this, but the two main ones are by utilising <strong>tidyverse</strong>’s <code>across()</code> function, or by using the Base R <code>apply()</code> function.</p>
<div class="panelset">
<section id="across" class="level4 panel">
<h4 class="anchored" data-anchor-id="across">across()</h4>
<p>The <code>across()</code> function works inside other tidyverse functions like <code>summarise()</code> and <code>mutate()</code>, and allows us to do the same operation across a set of columns.</p>
<p>The syntax is (with either summarise or mutate):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(variables, operation))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As an example, suppose i wanted to summarise across the first three variables (<code>ppt</code>,<code>age</code>, and <code>height</code>) and get the mean. We can either specify the column numbers, or a set of names, or use the <code>:</code> to choose all variables between two columns.<br>
These all do the same:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, mean))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(ppt,age,height), mean))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(ppt<span class="sc">:</span>height), mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
    ppt   age height
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1  38.5  24.3     NA</code></pre>
</div>
</div>
<p>Note that we get an NA in the mean heights, because there is an NA in the data. So we need to specify that <code>na.rm=TRUE</code> when using the <code>mean()</code> function.<br>
Unfortunately, this won’t work:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">mean</span>(<span class="at">na.rm=</span>T)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `summarise()`:
ℹ In argument: `across(1:3, mean(na.rm = T))`.
Caused by error in `mean.default()`:
! argument "x" is missing, with no default</code></pre>
</div>
</div>
<p>This is because when we open the brackets of <code>mean()</code>, it looks for the object we want to take the mean of. We can pass this through using <code>~</code> and <code>.</code>, like so: (You can kind of read the <code>.</code> as a place-holder for each variable)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="sc">~</span><span class="fu">mean</span>(<span class="at">x=</span>., <span class="at">na.rm=</span>T)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
    ppt   age height
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1  38.5  24.3   169.</code></pre>
</div>
</div>
<p>Using this syntax, we can apply the recoding we have seen above, but do it for all of the variables from <code>q1</code> to <code>q50</code>. All at once. like magic!<br>
Note, we’re not summarising here (i.e.&nbsp;we’re not summarising down into a single value, we’re just wanting to mutate the existing variables):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(q1<span class="sc">:</span>q50,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span><span class="fu">case_match</span>(., </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Very Inaccurate"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Moderately Inaccurate"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Neither Accurate nor Inaccurate"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Moderately Accurate"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Very Accurate"</span> <span class="sc">~</span> <span class="dv">5</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 53
     ppt   age height    q1    q2    q3    q4    q5    q6    q7    q8    q9
   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1    22    168     4     1     4     4     3     2     4     4     4
 2     2    29    186     3     2     4     3     4     2     4     2     3
 3     3    24     NA     1     1     3     2     2     4     4     3     4
 4     4    26    175     1     2     4     4     5     2     4     4     2
 5     5    28    182     1     1     3     4     4     5     3     3     2
 6     6    27    159     4     1     2     1     1     3     4     1     3
 7     7    27    149     2     1     4     5     4     4     4     4     3
 8     8    23    178     2     3     5     5     3     3     2     1     1
 9     9    28    176     3     2     5     5     5     3     5     3     3
10    10    26    192     3     1     4     4     4     3     4     4     4
# ℹ 66 more rows
# ℹ 41 more variables: q10 &lt;dbl&gt;, q11 &lt;dbl&gt;, q12 &lt;dbl&gt;, q13 &lt;dbl&gt;, q14 &lt;dbl&gt;,
#   q15 &lt;dbl&gt;, q16 &lt;dbl&gt;, q17 &lt;dbl&gt;, q18 &lt;dbl&gt;, q19 &lt;dbl&gt;, q20 &lt;dbl&gt;,
#   q21 &lt;dbl&gt;, q22 &lt;dbl&gt;, q23 &lt;dbl&gt;, q24 &lt;dbl&gt;, q25 &lt;dbl&gt;, q26 &lt;dbl&gt;,
#   q27 &lt;dbl&gt;, q28 &lt;dbl&gt;, q29 &lt;dbl&gt;, q30 &lt;dbl&gt;, q31 &lt;dbl&gt;, q32 &lt;dbl&gt;,
#   q33 &lt;dbl&gt;, q34 &lt;dbl&gt;, q35 &lt;dbl&gt;, q36 &lt;dbl&gt;, q37 &lt;dbl&gt;, q38 &lt;dbl&gt;,
#   q39 &lt;dbl&gt;, q40 &lt;dbl&gt;, q41 &lt;dbl&gt;, q42 &lt;dbl&gt;, q43 &lt;dbl&gt;, q44 &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section>
<section id="apply" class="level4 panel">
<h4 class="anchored" data-anchor-id="apply">apply()</h4>
<p>Base R (the non-tidyverse stuff) has some really useful functions of the <code>apply()</code> family, that can allow us to do the same thing (apply an operation across a set of columns).</p>
<p>For <code>apply()</code>, we give it an object like a dataframe, and we give it the dimension that we wish to perform the operation over. If we choose 1, it will do it for each row, and if we choose 2, it will do it for each column.<br>
So if we want the mean of the first 3 columns:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(survdat[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">MARGIN=</span><span class="dv">2</span>, <span class="at">FUN=</span>mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ppt    age height 
  38.5   24.3     NA </code></pre>
</div>
</div>
<p>Much like with <code>across()</code>, this doesn’t work because <code>mean()</code> now wants x explicitly given:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(survdat[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">MARGIN=</span><span class="dv">2</span>, <span class="at">FUN=</span><span class="fu">mean</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in mean.default(na.rm = TRUE): argument "x" is missing, with no default</code></pre>
</div>
</div>
<p>But instead of the <code>~</code> and <code>.</code> stuff in tidyverse, the <code>apply()</code> wants us to explicitly define a little function, using <code>function()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(survdat[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">MARGIN=</span><span class="dv">2</span>, <span class="at">FUN=</span><span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ppt    age height 
  38.5   24.3  169.4 </code></pre>
</div>
</div>
<p>(it’s actually just convention that people use <code>function(x)</code>. we could use <code>function(kermit) mean(kermit, na.rm=TRUE)</code> and it would still work!)</p>
<p>So how do we do the recoding of all our questions? We simply apply a function like <code>case_match()</code> to each column!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>survdat[,<span class="dv">4</span><span class="sc">:</span><span class="dv">53</span>] <span class="ot">&lt;-</span> <span class="fu">apply</span>(survdat[,<span class="dv">4</span><span class="sc">:</span><span class="dv">53</span>], <span class="at">MARGIN=</span><span class="dv">2</span>, <span class="at">FUN=</span><span class="cf">function</span>(x) </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">case_match</span>(x, </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Very Inaccurate"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Moderately Inaccurate"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Neither Accurate nor Inaccurate"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Moderately Accurate"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Very Accurate"</span> <span class="sc">~</span> <span class="dv">5</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>survdat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 53
     ppt   age height    q1    q2    q3    q4    q5    q6    q7    q8    q9
   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1    22    168     4     1     4     4     3     2     4     4     4
 2     2    29    186     3     2     4     3     4     2     4     2     3
 3     3    24     NA     1     1     3     2     2     4     4     3     4
 4     4    26    175     1     2     4     4     5     2     4     4     2
 5     5    28    182     1     1     3     4     4     5     3     3     2
 6     6    27    159     4     1     2     1     1     3     4     1     3
 7     7    27    149     2     1     4     5     4     4     4     4     3
 8     8    23    178     2     3     5     5     3     3     2     1     1
 9     9    28    176     3     2     5     5     5     3     5     3     3
10    10    26    192     3     1     4     4     4     3     4     4     4
# ℹ 66 more rows
# ℹ 41 more variables: q10 &lt;dbl&gt;, q11 &lt;dbl&gt;, q12 &lt;dbl&gt;, q13 &lt;dbl&gt;, q14 &lt;dbl&gt;,
#   q15 &lt;dbl&gt;, q16 &lt;dbl&gt;, q17 &lt;dbl&gt;, q18 &lt;dbl&gt;, q19 &lt;dbl&gt;, q20 &lt;dbl&gt;,
#   q21 &lt;dbl&gt;, q22 &lt;dbl&gt;, q23 &lt;dbl&gt;, q24 &lt;dbl&gt;, q25 &lt;dbl&gt;, q26 &lt;dbl&gt;,
#   q27 &lt;dbl&gt;, q28 &lt;dbl&gt;, q29 &lt;dbl&gt;, q30 &lt;dbl&gt;, q31 &lt;dbl&gt;, q32 &lt;dbl&gt;,
#   q33 &lt;dbl&gt;, q34 &lt;dbl&gt;, q35 &lt;dbl&gt;, q36 &lt;dbl&gt;, q37 &lt;dbl&gt;, q38 &lt;dbl&gt;,
#   q39 &lt;dbl&gt;, q40 &lt;dbl&gt;, q41 &lt;dbl&gt;, q42 &lt;dbl&gt;, q43 &lt;dbl&gt;, q44 &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
optional: more complex functions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We can also define our custom functions outside of the use of <code>apply()</code>/<code>across()</code>, which can be useful if we have more complex functions.</p>
<p>For example, we can do the same recoding and <em>then</em> standardise each variable, by explicitly defining a function that does that:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>recodemysurvey <span class="ot">&lt;-</span> <span class="cf">function</span>(question){</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  score <span class="ot">=</span> <span class="fu">case_match</span>(question, </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Very Inaccurate"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Moderately Inaccurate"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Neither Accurate nor Inaccurate"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Moderately Accurate"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Very Accurate"</span> <span class="sc">~</span> <span class="dv">5</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  score <span class="ot">=</span> (score <span class="sc">-</span> <span class="fu">mean</span>(score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="fu">sd</span>(score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(score)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And then using that function, either with:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(q1<span class="sc">:</span>q50, recodemysurvey))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or with:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(survdat[,<span class="dv">4</span><span class="sc">:</span><span class="dv">53</span>], <span class="dv">2</span>, recodemysurvey)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="divider div-transparent div-dot">

</div>
</section>
<section id="reverse-coding" class="level1">
<h1>Reverse coding</h1>
<p>It’s very common for questionnaires to have a combination of questions for a construct, some of which are positively phrased and some which are negatively phrased. The idea here is to avoid introducing biases such as a bias to agree more than to disagree.</p>
<p>Take, for instance, <code>q1</code> and <code>q6</code> in our data, which are both measuring Extraversion:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>datadict <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"q1"</span>,<span class="st">"q6"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  variable question                     
  &lt;chr&gt;    &lt;chr&gt;                        
1 q1       [I am the life of the party.]
2 q6       [I don't talk a lot.]        </code></pre>
</div>
</div>
<p>Someone very extraverted might respond to <code>q1</code> with “Very Accurate”, and <code>q6</code> with “Very Inaccurate”.</p>
<p>Often when we have a set of questions, we will want to reverse code the negatively phrased ones in order to have them all in the same direction. I.e. once they are recoded into numbers, we want the value 5 to represent highly extraverted on <em>both</em> <code>q1</code> and <code>q6</code>.</p>
<p>How do we reverse? We want any value of 1 to become 5, any value of 2 to become 4, 3 stays 3, 4 becomes 2, and 5 becomes 1.<br>
We can just subtract the value from 6!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5 4 3 2 1</code></pre>
</div>
</div>
<p>So to reverse code <code>q6</code>, we can simply subtract the variable from 6.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">q6 =</span> <span class="dv">6</span><span class="sc">-</span>q6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 53
     ppt   age height    q1    q2    q3    q4    q5    q6    q7    q8    q9
   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1    22    168     4     1     4     4     3     4     4     4     4
 2     2    29    186     3     2     4     3     4     4     4     2     3
 3     3    24     NA     1     1     3     2     2     2     4     3     4
 4     4    26    175     1     2     4     4     5     4     4     4     2
 5     5    28    182     1     1     3     4     4     1     3     3     2
 6     6    27    159     4     1     2     1     1     3     4     1     3
 7     7    27    149     2     1     4     5     4     2     4     4     3
 8     8    23    178     2     3     5     5     3     3     2     1     1
 9     9    28    176     3     2     5     5     5     3     5     3     3
10    10    26    192     3     1     4     4     4     3     4     4     4
# ℹ 66 more rows
# ℹ 41 more variables: q10 &lt;dbl&gt;, q11 &lt;dbl&gt;, q12 &lt;dbl&gt;, q13 &lt;dbl&gt;, q14 &lt;dbl&gt;,
#   q15 &lt;dbl&gt;, q16 &lt;dbl&gt;, q17 &lt;dbl&gt;, q18 &lt;dbl&gt;, q19 &lt;dbl&gt;, q20 &lt;dbl&gt;,
#   q21 &lt;dbl&gt;, q22 &lt;dbl&gt;, q23 &lt;dbl&gt;, q24 &lt;dbl&gt;, q25 &lt;dbl&gt;, q26 &lt;dbl&gt;,
#   q27 &lt;dbl&gt;, q28 &lt;dbl&gt;, q29 &lt;dbl&gt;, q30 &lt;dbl&gt;, q31 &lt;dbl&gt;, q32 &lt;dbl&gt;,
#   q33 &lt;dbl&gt;, q34 &lt;dbl&gt;, q35 &lt;dbl&gt;, q36 &lt;dbl&gt;, q37 &lt;dbl&gt;, q38 &lt;dbl&gt;,
#   q39 &lt;dbl&gt;, q40 &lt;dbl&gt;, q41 &lt;dbl&gt;, q42 &lt;dbl&gt;, q43 &lt;dbl&gt;, q44 &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>But we’re going to want to do this for all the negatively phrased questions in our survey. If we take a look at the <a href="https://ipip.ori.org/new_ipip-50-item-scale.htm" target="_blank">inventory page of the IPIP</a>, we can see that these are all the even questions from 2 to 38, and then questions 39, 44, 46, and 49.</p>
<p>That’s a frustrating set!<br>
Let’s find a way to capture those. <code>seq(2,38,2)</code> will give us a sequence from 2 to 38 in steps of 2. So that gives us most of them. We can then just combine that with the other ones, and put “q” in front of each one to give us the variable names:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>neg_items <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"q"</span>, <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">38</span>,<span class="dv">2</span>),<span class="dv">39</span>,<span class="dv">44</span>,<span class="dv">46</span>,<span class="dv">49</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>neg_items</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "q2"  "q4"  "q6"  "q8"  "q10" "q12" "q14" "q16" "q18" "q20" "q22" "q24"
[13] "q26" "q28" "q30" "q32" "q34" "q36" "q38" "q39" "q44" "q46" "q49"</code></pre>
</div>
</div>
<div class="panelset">
<section id="using-across" class="level4 panel">
<h4 class="anchored" data-anchor-id="using-across">using <code>across()</code></h4>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(neg_items),<span class="sc">~</span><span class="dv">6</span><span class="sc">-</span>.))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 53
     ppt   age height    q1    q2    q3    q4    q5    q6    q7    q8    q9
   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1    22    168     4     5     4     2     3     4     4     2     4
 2     2    29    186     3     4     4     3     4     4     4     4     3
 3     3    24     NA     1     5     3     4     2     2     4     3     4
 4     4    26    175     1     4     4     2     5     4     4     2     2
 5     5    28    182     1     5     3     2     4     1     3     3     2
 6     6    27    159     4     5     2     5     1     3     4     5     3
 7     7    27    149     2     5     4     1     4     2     4     2     3
 8     8    23    178     2     3     5     1     3     3     2     5     1
 9     9    28    176     3     4     5     1     5     3     5     3     3
10    10    26    192     3     5     4     2     4     3     4     2     4
# ℹ 66 more rows
# ℹ 41 more variables: q10 &lt;dbl&gt;, q11 &lt;dbl&gt;, q12 &lt;dbl&gt;, q13 &lt;dbl&gt;, q14 &lt;dbl&gt;,
#   q15 &lt;dbl&gt;, q16 &lt;dbl&gt;, q17 &lt;dbl&gt;, q18 &lt;dbl&gt;, q19 &lt;dbl&gt;, q20 &lt;dbl&gt;,
#   q21 &lt;dbl&gt;, q22 &lt;dbl&gt;, q23 &lt;dbl&gt;, q24 &lt;dbl&gt;, q25 &lt;dbl&gt;, q26 &lt;dbl&gt;,
#   q27 &lt;dbl&gt;, q28 &lt;dbl&gt;, q29 &lt;dbl&gt;, q30 &lt;dbl&gt;, q31 &lt;dbl&gt;, q32 &lt;dbl&gt;,
#   q33 &lt;dbl&gt;, q34 &lt;dbl&gt;, q35 &lt;dbl&gt;, q36 &lt;dbl&gt;, q37 &lt;dbl&gt;, q38 &lt;dbl&gt;,
#   q39 &lt;dbl&gt;, q40 &lt;dbl&gt;, q41 &lt;dbl&gt;, q42 &lt;dbl&gt;, q43 &lt;dbl&gt;, q44 &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section>
<section id="using-apply" class="level4 panel">
<h4 class="anchored" data-anchor-id="using-apply">using <code>apply()</code></h4>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>survdat[,neg_items] <span class="ot">&lt;-</span> <span class="fu">apply</span>(survdat[,neg_items], <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="dv">6</span><span class="sc">-</span>x)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>survdat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 53
     ppt   age height    q1    q2    q3    q4    q5    q6    q7    q8    q9
   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1    22    168     4     5     4     2     3     4     4     2     4
 2     2    29    186     3     4     4     3     4     4     4     4     3
 3     3    24     NA     1     5     3     4     2     2     4     3     4
 4     4    26    175     1     4     4     2     5     4     4     2     2
 5     5    28    182     1     5     3     2     4     1     3     3     2
 6     6    27    159     4     5     2     5     1     3     4     5     3
 7     7    27    149     2     5     4     1     4     2     4     2     3
 8     8    23    178     2     3     5     1     3     3     2     5     1
 9     9    28    176     3     4     5     1     5     3     5     3     3
10    10    26    192     3     5     4     2     4     3     4     2     4
# ℹ 66 more rows
# ℹ 41 more variables: q10 &lt;dbl&gt;, q11 &lt;dbl&gt;, q12 &lt;dbl&gt;, q13 &lt;dbl&gt;, q14 &lt;dbl&gt;,
#   q15 &lt;dbl&gt;, q16 &lt;dbl&gt;, q17 &lt;dbl&gt;, q18 &lt;dbl&gt;, q19 &lt;dbl&gt;, q20 &lt;dbl&gt;,
#   q21 &lt;dbl&gt;, q22 &lt;dbl&gt;, q23 &lt;dbl&gt;, q24 &lt;dbl&gt;, q25 &lt;dbl&gt;, q26 &lt;dbl&gt;,
#   q27 &lt;dbl&gt;, q28 &lt;dbl&gt;, q29 &lt;dbl&gt;, q30 &lt;dbl&gt;, q31 &lt;dbl&gt;, q32 &lt;dbl&gt;,
#   q33 &lt;dbl&gt;, q34 &lt;dbl&gt;, q35 &lt;dbl&gt;, q36 &lt;dbl&gt;, q37 &lt;dbl&gt;, q38 &lt;dbl&gt;,
#   q39 &lt;dbl&gt;, q40 &lt;dbl&gt;, q41 &lt;dbl&gt;, q42 &lt;dbl&gt;, q43 &lt;dbl&gt;, q44 &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section>
</div>
<div class="divider div-transparent div-dot">

</div>
</section>
<section id="row-scoring" class="level1">
<h1>Row scoring</h1>
<p>Very often, people want to calculate a scale score. For instance, if people responded to each of 7 questions for a scale of generalised anxiety, then we would want to calculate a ‘generalised anxiety score’ by adding up their responses 5+1+2+4+4+3+5 = 24.</p>
<p>There are handy functions that can do quick row scoring: <code>rowSums()</code> and <code>rowMeans()</code>.</p>
<p>For instance, to calculate each person’s (each row of our data is a person) sum of the questions 1 to 5, we can use any of:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tidyverse</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> <span class="fu">select</span>(q1<span class="sc">:</span>q5) <span class="sc">|&gt;</span> <span class="fu">rowSums</span>()</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># indexing:</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rowSums</span>(survdat[,<span class="fu">c</span>(<span class="st">"q1"</span>,<span class="st">"q2"</span>,<span class="st">"q3"</span>,<span class="st">"q4"</span>,<span class="st">"q5"</span>)])</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># concise indexing</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rowSums</span>(survdat[, <span class="fu">paste0</span>(<span class="st">"q"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code> [1] 18 18 15 16 15 17 16 14 18 18 17  8 16 13 11 14 16 18 20 17 13 16 14 17 17
[26] 18 19 14 16 12 18 20 18 17 15 15  7 12 15 15 19 17 22 20 20 19 16 14 17 10
[51] 15 18 19 17 10 19 16 12 22 16 12 15 14 19  9  9 17 20 15 17 19 16 18 16 13
[76] 14</code></pre>
</div>
</div>
<p>From the <a href="https://ipip.ori.org/new_ipip-50-item-scale.htm" target="_blank">inventory page of the IPIP</a>, we can see that the questions are ordered such that questions 1, 6, 11, …, all correspond to Extraversion, questions 2, 7, 12, … all correspond to Agreeableness, and so on.</p>
<p>We can use things like <code>seq()</code> to capture the relevant numbers of each question:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sequence from 1 to 50 in steps of 5</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">50</span>,<span class="dv">5</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  6 11 16 21 26 31 36 41 46</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sequence from 1 to 50 in steps of 5</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">50</span>,<span class="dv">5</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  2  7 12 17 22 27 32 37 42 47</code></pre>
</div>
</div>
<p>Which means we can get the scores for each personality trait using something such as:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>survdat<span class="sc">$</span>extr <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(survdat[, <span class="fu">paste0</span>(<span class="st">"q"</span>,<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">50</span>,<span class="dv">5</span>))])</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>survdat<span class="sc">$</span>agree <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(survdat[, <span class="fu">paste0</span>(<span class="st">"q"</span>,<span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">50</span>,<span class="dv">5</span>))])</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>survdat<span class="sc">$</span>consc <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(survdat[, <span class="fu">paste0</span>(<span class="st">"q"</span>,<span class="fu">seq</span>(<span class="dv">3</span>,<span class="dv">50</span>,<span class="dv">5</span>))])</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>survdat<span class="sc">$</span>emot_s <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(survdat[, <span class="fu">paste0</span>(<span class="st">"q"</span>,<span class="fu">seq</span>(<span class="dv">4</span>,<span class="dv">50</span>,<span class="dv">5</span>))])</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>survdat<span class="sc">$</span>imagin <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(survdat[, <span class="fu">paste0</span>(<span class="st">"q"</span>,<span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">50</span>,<span class="dv">5</span>))])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we can quickly examine all our scale scores:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(extr<span class="sc">:</span>imagin) <span class="sc">|&gt;</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairs.panels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="r07_qdata_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="divider div-transparent div-dot">

</div>
</section>
<section id="more-rowwise-stuff" class="level1">
<h1>More Rowwise Stuff</h1>
<p>We can also find out useful information for each row about things like how much missingness there is:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># is.na will turn all NA entries to "TRUE", and all non-missing values to FALSE. </span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># then we sum them up across the rows and it will give us how many NAs are in each row, across the 50 questions!  </span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rowSums</span>( <span class="fu">is.na</span>( survdat[, <span class="fu">paste0</span>(<span class="st">"q"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)] ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 0 0 0 0 0 0 0 0 0 1 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0
[39] 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</code></pre>
</div>
</div>
<p>Occasionally, you might find that you want to do row-wise operations that don’t have easy functions like <code>rowSums</code>. In these cases, the tidyverse function <code>rowwise()</code> can be useful in that it applies an operation to one row at a time:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>survdat <span class="sc">|&gt;</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find the minimum score given for each row</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">maxscore =</span> <span class="fu">min</span>(<span class="fu">across</span>(q1<span class="sc">:</span>q50)), </span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># put the column after the height column</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.after =</span> height</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 59
# Rowwise: 
     ppt   age height maxscore    q1    q2    q3    q4    q5    q6    q7    q8
   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1    22    168        1     4     5     4     2     3     4     4     2
 2     2    29    186        2     3     4     4     3     4     4     4     4
 3     3    24     NA        1     1     5     3     4     2     2     4     3
 4     4    26    175        1     1     4     4     2     5     4     4     2
 5     5    28    182        1     1     5     3     2     4     1     3     3
 6     6    27    159        1     4     5     2     5     1     3     4     5
 7     7    27    149        1     2     5     4     1     4     2     4     2
 8     8    23    178        1     2     3     5     1     3     3     2     5
 9     9    28    176        1     3     4     5     1     5     3     5     3
10    10    26    192        1     3     5     4     2     4     3     4     2
# ℹ 66 more rows
# ℹ 47 more variables: q9 &lt;dbl&gt;, q10 &lt;dbl&gt;, q11 &lt;dbl&gt;, q12 &lt;dbl&gt;, q13 &lt;dbl&gt;,
#   q14 &lt;dbl&gt;, q15 &lt;dbl&gt;, q16 &lt;dbl&gt;, q17 &lt;dbl&gt;, q18 &lt;dbl&gt;, q19 &lt;dbl&gt;,
#   q20 &lt;dbl&gt;, q21 &lt;dbl&gt;, q22 &lt;dbl&gt;, q23 &lt;dbl&gt;, q24 &lt;dbl&gt;, q25 &lt;dbl&gt;,
#   q26 &lt;dbl&gt;, q27 &lt;dbl&gt;, q28 &lt;dbl&gt;, q29 &lt;dbl&gt;, q30 &lt;dbl&gt;, q31 &lt;dbl&gt;,
#   q32 &lt;dbl&gt;, q33 &lt;dbl&gt;, q34 &lt;dbl&gt;, q35 &lt;dbl&gt;, q36 &lt;dbl&gt;, q37 &lt;dbl&gt;,
#   q38 &lt;dbl&gt;, q39 &lt;dbl&gt;, q40 &lt;dbl&gt;, q41 &lt;dbl&gt;, q42 &lt;dbl&gt;, q43 &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Alternatively, <code>apply()</code> to the rescue again!<br>
<code>MARGIN = 1</code> here applies the operation across rows:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(survdat[,<span class="fu">paste0</span>(<span class="st">"q"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)], <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> min)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  1  1  1  1  1  1  1  1 NA  1  1  1 NA  1  1  1  2  1  1  1  1  1  1
[26]  1  1  1  2 NA  1  1  1  1  1  1  1  1  1  1  2  2  2  2  1  1  1 NA  1  1
[51]  1  1  2  1  1  1  1  1  1  1  1  1  1  1  1  1  2  1  2  1  1  1  1  1  1
[76]  1</code></pre>
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Technically this is pronounced “LICK-URT” and not “LIE-KURT”. It’s named after <a href="https://en.wikipedia.org/wiki/Rensis_Likert" target="_blank">Dr Rensis Likert</a>, and that’s how he pronounced his name!<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>